{"type":"rrf_header","version":"1.1","generated_at":"2026-01-15T04:50:05Z","generator":{"name":"dump-rrf.sh","revision":"b1f8b10"}}
{"type":"file","path":".gitignore","role":"vcs-config","criticality":"unknown","bytes":148,"sha1":"f4e09296a7168b2f3c22afa4d37c6e351ea39852","truncated":false,"content":"# secret files\nsecret.yaml\nsecrets.yaml\n*-secret.yaml\n*-secrets.yaml\n\n# Auxiliary sample files\ndefaultValues.yaml\n\n*.json\n\nmanifests/certs\n\nprint.sh"}
{"type":"file","path":".sops.yaml","role":"sops-config","criticality":"critical","bytes":197,"sha1":"82f7d3e2bb46a72836ffdaf2e80ba5cb51c69883","truncated":true,"content":null}
{"type":"file","path":"Makefile","role":"tooling","criticality":"low","bytes":3223,"sha1":"a89c0a8302dec2f3f3d67b8fddd3c9a280b73391","truncated":false,"content":"# =============================================================================\n# k3s-smarthome Makefile\n# =============================================================================\n\n# Absolute path to the directory containing this Makefile\nROOT_DIR := $(realpath $(dir $(lastword $(MAKEFILE_LIST))))\nSCRIPTS_DIR := $(ROOT_DIR)/scripts\n\nSOPS_CONFIG := .sops.yaml\n\n# Directory where operators live\nOPERATORS_DIR := $(ROOT_DIR)/helm/infra/operators\n\n# -------------------------------------------------------------------\n# Detect SOPS binary\n# -------------------------------------------------------------------\nSOPS_BIN := $(shell command -v sops)\n\nifeq ($(SOPS_BIN),)\n$(error \"sops not found in PATH\")\nendif\n\n# -------------------------------------------------------------------\n# List all operators (directories under helm/infra/operators)\n# -------------------------------------------------------------------\nOPERATORS := $(shell find $(OPERATORS_DIR) -mindepth 1 -maxdepth 1 -type d -exec basename {} \\;)\n\n# -------------------------------------------------------------------\n# Phony targets\n# -------------------------------------------------------------------\n.PHONY: encrypt encrypt-all check-op check-versions\n\n# -------------------------------------------------------------------\n# Validate operator\n# -------------------------------------------------------------------\ncheck-op:\n\t@if [ -n \"$(OP)\" ] && [ ! -d \"$(OPERATORS_DIR)/$(OP)\" ]; then \\\n\t\techo \"[ERROR] Operator '$(OP)' does not exist under $(OPERATORS_DIR)\"; \\\n\t\texit 1; \\\n\tfi\n\n# -------------------------------------------------------------------\n# Encrypt single operator\n# -------------------------------------------------------------------\nencrypt: check-op\n\t@set -e; \\\n\tif [ -n \"$(OP)\" ]; then \\\n\t\tOP_LIST=\"$(OP)\"; \\\n\telse \\\n\t\tOP_LIST=\"$(OPERATORS)\"; \\\n\tfi; \\\n\tfor op_name in $$OP_LIST; do \\\n\t\tK8S_DIR=\"$(OPERATORS_DIR)/$$op_name/k8s\"; \\\n\t\tfor f in $$K8S_DIR/*secret.yaml; do \\\n\t\t\t[ -f \"$$f\" ] || continue; \\\n\t\t\tout=\"$${f%.yaml}.sops.yaml\"; \\\n\t\t\techo \"[INFO] Encrypting $$f â†’ $$out\"; \\\n\t\t\t$(SOPS_BIN) -e \"$$f\" > \"$$out\"; \\\n\t\tdone; \\\n\tdone\n\n# -------------------------------------------------------------------\n# Encrypt all secrets in the repo, commit, and push\n# -------------------------------------------------------------------\nencrypt-all: encrypt\n\t@echo \"[INFO] Updating git index for all encrypted files\"; \\\n\tupdated_files=$$(git -C $(ROOT_DIR) ls-files '*.sops.yaml'); \\\n\tif [ -n \"$$updated_files\" ]; then \\\n\t\tgit -C $(ROOT_DIR) add $$updated_files; \\\n\t\tif git -C $(ROOT_DIR) diff --cached --quiet; then \\\n\t\t\techo \"[INFO] No changes to commit\"; \\\n\t\telse \\\n\t\t\tgit -C $(ROOT_DIR) commit -m \"Update SOPS-encrypted secrets (*.sops.yaml)\"; \\\n\t\t\tcurrent_branch=$$(git -C $(ROOT_DIR) rev-parse --abbrev-ref HEAD); \\\n\t\t\techo \"[INFO] Pushing committed changes to $$current_branch\"; \\\n\t\t\tgit -C $(ROOT_DIR) push origin $$current_branch; \\\n\t\tfi; \\\n\telse \\\n\t\techo \"[INFO] No encrypted files to add\"; \\\n\tfi\n\n# -------------------------------------------------------------------\n# Check versions (host tooling / calico / operators)\n# -------------------------------------------------------------------\ncheck-versions:\n\t@$(SCRIPTS_DIR)/check-versions.sh\n"}
{"type":"file","path":"README.md","role":"unknown","criticality":"unknown","bytes":296,"sha1":"37a8437491f74141a54d0ace3dabce248d76ce8e","truncated":false,"content":"# Reference Repository (Read-Only)\n\nThis repository is a **public, read-only mirror** of a private\ninfrastructure repository.\n\n- This repo **does not accept direct changes**\n- All development happens elsewhere\n- `main` is the only authoritative branch\n\nIssues and PRs may be ignored or disabled.\n"}
{"type":"file","path":"bootstrap.env","role":"config-env","criticality":"medium","bytes":3197,"sha1":"74c3a2553373962a155727b510130bb550c39d66","truncated":false,"content":"# =============================================================================\n# Host\n# =============================================================================\n\n# SOPS\nSOPS_VERSION='3.9.4'\nSOPS_REPO='https://github.com/getsops/sops/releases/download/%v/sops-%v.linux.amd64'\n\n# =============================================================================\n# Infrastructure\n# =============================================================================\n\n# === K3s / Kubernetes ===\nK3S_VERSION='1.31.14+k3s1'\nK3S_REPO='https://get.k3s.io'\n# CLUSTER_CIDR='10.10.250.0/24'\n\n# === Helm ===\nHELM_VERSION='3.14.2'\nHELM_REPO='https://get.helm.sh/helm-%v-linux-amd64.tar.gz'\n\n# === CNI / Calico ===\nCALICO_CRD_REPO='https://raw.githubusercontent.com/projectcalico/calico/master/manifests/operator-crds.yaml'\nCALICO_OPERATOR_NAME='tigera-operator'\nCALICO_OPERATOR_VERSION='3.31.3'\nCALICO_OPERATOR_REPO='https://raw.githubusercontent.com/projectcalico/calico/%v/manifests/tigera-operator.yaml'\n\n# =============================================================================\n# Operators\n# =============================================================================\n\n# SOPS Secrets Operator\nSOPS_OPERATOR_NAME='sops-operator'\nSOPS_OPERATOR_CHART='sops-operator/sops-secrets-operator'\nSOPS_OPERATOR_CHART_VERSION='0.24.1'\nSOPS_OPERATOR_REPO='https://isindir.github.io/sops-secrets-operator/'\n\n# Cert-Manager\nCERT_MANAGER_NAME='cert-manager'\nCERT_MANAGER_CHART='jetstack/cert-manager'\nCERT_MANAGER_CHART_VERSION='1.19.2'\nCERT_MANAGER_CHART_REPO='https://charts.jetstack.io'\n\n# Traefik\nTRAEFIK_NAME='traefik'\nTRAEFIK_CHART='traefik/traefik'\nTRAEFIK_CHART_VERSION='38.0.1'\nTRAEFIK_CHART_REPO='https://traefik.github.io/charts'\n\n# Cloudflared\nCLOUDFLARED_NAME='cloudflared'\nCLOUDFLARED_CHART='community-charts/cloudflared'\nCLOUDFLARED_CHART_VERSION='2.2.4'\nCLOUDFLARED_CHART_REPO='https://community-charts.github.io/helm-charts'\n\n# =============================================================================\n# Platform\n# =============================================================================\n\nHOME_ASSISTANT_NAME='home-assistant'\nHOME_ASSISTANT_CHART='pajikos/home-assistant'\nHOME_ASSISTANT_CHART_VERSION='0.3.38'\nHOME_ASSISTANT_CHART_REPO='http://pajikos.github.io/home-assistant-helm-chart/'\n\n# =======================================================================\n#            AUTO-GENERATED CONTENT; DO NOT EDIT!\n# =======================================================================\n\n# Cluster\nSOPS_VERSION_LATEST='3.11.0'\nSOPS_VERSION_PREV='3.9.4'\nK3S_VERSION_LATEST='1.35.0+k3s1'\nK3S_VERSION_PREV='1.31.14+k3s1'\nHELM_VERSION_LATEST='4.0.4'\nHELM_VERSION_PREV='3.14.2'\nCALICO_OPERATOR_VERSION_LATEST='3.31.3'\nCALICO_OPERATOR_VERSION_PREV='3.31.3'\n# Infrastructure\nSOPS_OPERATOR_CHART_VERSION_LATEST='0.24.1'\nSOPS_OPERATOR_CHART_VERSION_PREV='0.24.1'\nCERT_MANAGER_CHART_VERSION_LATEST='1.19.2'\nCERT_MANAGER_CHART_VERSION_PREV='1.19.2'\nTRAEFIK_CHART_VERSION_LATEST='38.0.2'\nTRAEFIK_CHART_VERSION_PREV='38.0.1'\nCLOUDFLARED_CHART_VERSION_LATEST='2.2.4'\nCLOUDFLARED_CHART_VERSION_PREV='2.2.4'\n# Platform\nHOME_ASSISTANT_CHART_VERSION_LATEST='0.3.38'\nHOME_ASSISTANT_CHART_VERSION_PREV='0.3.38'"}
{"type":"file","path":"bootstrap/00-host.sh","role":"bootstrap-host","criticality":"critical","bytes":5964,"sha1":"4739695a5ac6268128d0203fc22fe23ec0cf782d","truncated":true,"content":null}
{"type":"file","path":"bootstrap/01-cluster.sh","role":"bootstrap-cluster","criticality":"critical","bytes":6667,"sha1":"e12c0d66bb3316fcf8cd9b169231425ff1fa30d2","truncated":true,"content":null}
{"type":"file","path":"bootstrap/02-infra.sh","role":"bootstrap-infra","criticality":"critical","bytes":10004,"sha1":"5325422c2c4664c07f9ade5dcbfe04e26611608b","truncated":true,"content":null}
{"type":"file","path":"bootstrap/03-smoke-infra-resources.sh","role":"bootstrap-infra","criticality":"critical","bytes":3947,"sha1":"ca7a5c4c39a9430afa4ca0f32291746e308d0abf","truncated":true,"content":null}
{"type":"file","path":"bootstrap/03-smoke-sops.sh","role":"bootstrap-smoke","criticality":"unknown","bytes":1558,"sha1":"cb66dd8dd6deb98aedd3d893263910e3d9def20d","truncated":false,"content":"#!/usr/bin/env bash\nset -euo pipefail\n\nROOT_DIR=\"$(cd \"$(dirname \"${BASH_SOURCE[0]}\")/..\" && pwd)\"\nsource \"${ROOT_DIR}/lib/loader.sh\"\n\nlog \"=== Phase 03: Infra Smoke Test ===\"\n\n# -------------------------------------------------------------------\n# Create temporary test secret with SOPS\n# -------------------------------------------------------------------\nTMP_NS=\"default\"\nTMP_SECRET=\"test-sopssecret\"\nTMP_FILE=\"$(mktemp /tmp/test-sopssecret.XXXX.yaml)\"\n\ncat > \"$TMP_FILE\" <<EOF\napiVersion: isindir.github.com/v1alpha3\nkind: SopsSecret\nmetadata:\n  name: $TMP_SECRET\n  namespace: $TMP_NS\nspec:\n  suspend: false\n  secretTemplates:\n    - name: $TMP_SECRET\n      stringData:\n        password: test\nEOF\n\nENC_FILE=\"${TMP_FILE}.sops.yaml\"\nsops -e \"$TMP_FILE\" > \"$ENC_FILE\"\n\nkubectl apply -f \"$ENC_FILE\"\n\n# -------------------------------------------------------------------\n# Verify secret exists and decodes correctly\n# -------------------------------------------------------------------\nTIMEOUT=30\nfor i in $(seq 1 $TIMEOUT); do\n  if kubectl get secret $TMP_SECRET -n $TMP_NS >/dev/null 2>&1; then break; fi\n  sleep 1\ndone\n\nlog -n \"Decoded secret: \"\nkubectl get secret $TMP_SECRET -n $TMP_NS -o jsonpath='{.data.password}' | base64 -d\nlog\n\n# -------------------------------------------------------------------\n# Cleanup\n# -------------------------------------------------------------------\nkubectl delete secret $TMP_SECRET -n $TMP_NS\nkubectl delete sopssecret $TMP_SECRET -n $TMP_NS\nrm -f \"$TMP_FILE\" \"$ENC_FILE\"\n\nlog \"=== SOPS secret smoke test complete ===\"\n"}
{"type":"file","path":"bootstrap/04-platform.sh","role":"bootstrap-script","criticality":"unknown","bytes":6133,"sha1":"ee817a6aaf4425f667461a075cf420f80d1c62a7","truncated":false,"content":"#!/usr/bin/env bash\nset -euo pipefail\ntrap 'log_error \"Script failed at line ${LINENO}: ${BASH_COMMAND}\"' ERR\n\nROOT_DIR=\"$(cd \"$(dirname \"${BASH_SOURCE[0]}\")/..\" && pwd)\"\nsource \"${ROOT_DIR}/lib/loader.sh\"\n\nlog_info \"=== Phase 04: Platform Bootstrap ===\"\nlog_debug \"ROOT_DIR=${ROOT_DIR}\"\n\n# -------------------------------------------------------------------\n# Load bootstrap.env\n# -------------------------------------------------------------------\n\nBOOTSTRAP_ENV_FILE=\"${ROOT_DIR}/bootstrap.env\"\nif [[ -f \"$BOOTSTRAP_ENV_FILE\" ]]; then\n  log_debug \"Sourcing bootstrap.env from $BOOTSTRAP_ENV_FILE\"\n  source \"$BOOTSTRAP_ENV_FILE\"\nelse\n  log_warn \"bootstrap.env not found; proceeding without environment overrides\"\nfi\n\n# -------------------------------------------------------------------\n# Platform Layer Functions\n# -------------------------------------------------------------------\n\nresolve_workload_env_vars() {\n  log_debug \"Resolving environment variables for workload: ${WORKLOAD_NAME}\"\n\n  # initialize all optional overrides (required for set -u)\n  WORKLOAD_NAMESPACE_OVERRIDE=\"\"\n  WORKLOAD_CHART_OVERRIDE=\"\"\n  WORKLOAD_CHART_VERSION_OVERRIDE=\"\"\n  WORKLOAD_CHART_REPO_OVERRIDE=\"\"\n\n  local envvar base fullvar\n\n  for envvar in $(compgen -v | grep '_NAME$'); do\n    [[ \"$envvar\" == \"WORKLOAD_NAME\" ]] && continue\n\n    log_debug \"Checking env var ${envvar}=${!envvar} against workload name ${WORKLOAD_NAME}\"\n\n    if [[ \"${!envvar}\" == \"$WORKLOAD_NAME\" ]]; then\n      base=\"${envvar%_NAME}\"\n      log_info \"Matched workload environment prefix: ${base}\"\n\n      fullvar=\"${base}_NAMESPACE\"\n      WORKLOAD_NAMESPACE_OVERRIDE=\"${!fullvar:-}\"\n\n      fullvar=\"${base}_CHART\"\n      WORKLOAD_CHART_OVERRIDE=\"${!fullvar:-}\"\n\n      fullvar=\"${base}_CHART_VERSION\"\n      WORKLOAD_CHART_VERSION_OVERRIDE=\"${!fullvar:-}\"\n\n      fullvar=\"${base}_CHART_REPO\"\n      WORKLOAD_CHART_REPO_OVERRIDE=\"${!fullvar:-}\"\n\n      log_debug \"Resolved overrides:\"\n      log_debug \"  NAMESPACE=${WORKLOAD_NAMESPACE_OVERRIDE:-<none>}\"\n      log_debug \"  CHART=${WORKLOAD_CHART_OVERRIDE:-<none>}\"\n      log_debug \"  VERSION=${WORKLOAD_CHART_VERSION_OVERRIDE:-<none>}\"\n      log_debug \"  REPO=${WORKLOAD_CHART_REPO_OVERRIDE:-<none>}\"\n      return 0\n    fi\n  done\n\n  log_debug \"No environment overrides matched workload '${WORKLOAD_NAME}'\"\n}\n\nhelm_install_or_upgrade_release() {\n  local release=\"$1\"\n  local chart=\"$2\"\n  local namespace=\"$3\"\n  local version=\"${4:-}\"\n  local values_file=\"${5:-}\"\n\n  log_info \"Installing/upgrading Helm release '${release}' in namespace '${namespace}'\"\n\n  local args=(upgrade --install \"$release\" \"$chart\" -n \"$namespace\")\n  [[ -n \"$version\" ]] && args+=(--version \"$version\")\n  [[ -f \"$values_file\" ]] && args+=(--values \"$values_file\")\n\n  log_debug \"Helm command: helm ${args[*]}\"\n  helm \"${args[@]}\"\n}\n\nbootstrap_platform_workloads() {\n  local app_dir values_file chart_file\n  local EFFECTIVE_CHART EFFECTIVE_NAMESPACE EFFECTIVE_VERSION EFFECTIVE_REPO\n\n  for app_dir in \"${ROOT_DIR}/helm/platform/\"*; do\n    [[ -d \"$app_dir\" ]] || continue\n    log_info \"Processing platform directory: ${app_dir}\"\n\n    load_workload_metadata \"$app_dir\" || {\n      log_warn \"No workload.yaml found in ${app_dir}, skipping\"\n      continue\n    }\n\n    validate_workload_kind || {\n      log_error \"Invalid workload kind in ${app_dir}, skipping\"\n      continue\n    }\n\n    log_debug \"Loaded workload metadata:\"\n    log_debug \"  Name=${WORKLOAD_NAME}\"\n    log_debug \"  Kind=${WORKLOAD_KIND}\"\n    log_debug \"  Namespace=${WORKLOAD_NAMESPACE}\"\n    log_debug \"  Rollout enabled=${WORKLOAD_ROLLOUT_ENABLED}\"\n    log_debug \"  Rollout timeout=${WORKLOAD_TIMEOUT}\"\n\n    resolve_workload_env_vars\n\n    values_file=\"${app_dir}/values.yaml\"\n    chart_file=\"${app_dir}/Chart.yaml\"\n\n    EFFECTIVE_NAMESPACE=\"${WORKLOAD_NAMESPACE_OVERRIDE:-$WORKLOAD_NAMESPACE}\"\n    EFFECTIVE_CHART=\"${WORKLOAD_CHART_OVERRIDE:-$app_dir}\"\n    EFFECTIVE_VERSION=\"${WORKLOAD_CHART_VERSION_OVERRIDE:-}\"\n    EFFECTIVE_REPO=\"${WORKLOAD_CHART_REPO_OVERRIDE:-}\"\n\n    log_info \"Effective configuration for '${WORKLOAD_NAME}':\"\n    log_info \"  Namespace=${EFFECTIVE_NAMESPACE}\"\n    log_info \"  Chart=${EFFECTIVE_CHART}\"\n    log_info \"  Version=${EFFECTIVE_VERSION:-<none>}\"\n    log_info \"  Values=${values_file:-<none>}\"\n    log_info \"  Repo=${EFFECTIVE_REPO:-<none>}\"\n\n    log_debug \"Ensuring namespace exists: ${EFFECTIVE_NAMESPACE}\"\n    kubectl create namespace \"${EFFECTIVE_NAMESPACE}\" \\\n      --dry-run=client -o yaml | kubectl apply -f -\n\n    if [[ -n \"$EFFECTIVE_REPO\" ]]; then\n      local REPO_NAME=\"${EFFECTIVE_CHART%%/*}\"   # Extract prefix from chart\n      declare -A TEMP_REPOS=([$REPO_NAME]=\"$EFFECTIVE_REPO\")\n      log_info \"Registering Helm repo '${REPO_NAME}' for '${WORKLOAD_NAME}'\"\n      helm_add_repos TEMP_REPOS\n    fi\n\n    if [[ -n \"$WORKLOAD_CHART_OVERRIDE\" || -f \"$chart_file\" ]]; then\n      log_info \"Deploying Helm workload '${WORKLOAD_NAME}'\"\n      helm_install_or_upgrade_release \\\n        \"$WORKLOAD_NAME\" \\\n        \"$EFFECTIVE_CHART\" \\\n        \"$EFFECTIVE_NAMESPACE\" \\\n        \"$EFFECTIVE_VERSION\" \\\n        \"$values_file\"\n    else\n      log_debug \"No Helm chart detected for '${WORKLOAD_NAME}'\"\n    fi\n\n    if [[ -d \"$app_dir/k8s\" ]]; then\n      log_info \"Applying raw Kubernetes manifests for '${WORKLOAD_NAME}'\"\n      shopt -s nullglob globstar\n      for f in \"$app_dir/k8s/\"**/*.y{a,}ml; do\n        [[ \"$f\" == *.sops.yaml ]] && continue\n        log_debug \"Applying manifest: ${f}\"\n        kubectl apply -f \"$f\"\n      done\n      shopt -u nullglob globstar\n    fi\n\n    if [[ \"$WORKLOAD_KIND\" != \"none\" ]]; then\n      log_info \"Waiting for workload readiness: ${WORKLOAD_NAME}\"\n      wait_for_workload\n    fi\n\n    log_info \"Workload '${WORKLOAD_NAME}' is ready\"\n  done\n}\n\n# -------------------------------------------------------------------\n# Main\n# -------------------------------------------------------------------\n\nmain() {\n  log_info \"Running platform preflight checks\"\n  check_required_cmds kubectl helm yq\n\n  log_info \"Bootstrapping platform workloads\"\n  bootstrap_platform_workloads\n}\n\nmain\nlog_info \"=== Phase 04 complete: platform components ready ===\"\n"}
{"type":"file","path":"bootstrap/k8s/calico.yaml","role":"unknown","criticality":"unknown","bytes":836,"sha1":"81240d1cdebfe9da8cd885e8f6c3d1048e0f03cc","truncated":false,"content":"apiVersion: operator.tigera.io/v1\nkind: Installation\nmetadata:\n  name: default\nspec:\n  calicoNetwork:\n    ipPools:\n      - name: default-ipv4-ippool\n        blockSize: 26\n        cidr: 10.10.250.0/24\n        encapsulation: VXLANCrossSubnet\n        natOutgoing: Enabled\n        nodeSelector: all()\n\n---\n# This section configures the Calico API server.\n# For more information, see: https://docs.tigera.io/calico/latest/reference/installation/api#operator.tigera.io/v1.APIServer\napiVersion: operator.tigera.io/v1\nkind: APIServer\nmetadata:\n  name: default\nspec: {}\n\n---\n# Configures the Calico Goldmane flow aggregator.\n# apiVersion: operator.tigera.io/v1\n# kind: Goldmane\n# metadata:\n#   name: default\n\n---\n# Configures the Calico Whisker observability UI.\n# apiVersion: operator.tigera.io/v1\n# kind: Whisker\n# metadata:\n#   name: default\n"}
{"type":"file","path":"bootstrap/wrapper.sh","role":"bootstrap-script","criticality":"unknown","bytes":3603,"sha1":"8a38632f7a54020ea4ab050d78116916d3181971","truncated":false,"content":"#!/usr/bin/env bash\nset -euo pipefail\n\nROOT_DIR=\"$(cd \"$(dirname \"${BASH_SOURCE[0]}\")/..\" && pwd)\"\nsource \"${ROOT_DIR}/lib/loader.sh\"\n\n# Default log level\nLOG_LEVEL=\"${LOG_LEVEL_INFO}\"\n\n# Parse CLI args for log level\nfor arg in \"$@\"; do\n  case \"${arg}\" in\n    --log=DEBUG) LOG_LEVEL=\"${LOG_LEVEL_DEBUG}\" ;;\n    --log=INFO)  LOG_LEVEL=\"${LOG_LEVEL_INFO}\" ;;\n    --log=WARN)  LOG_LEVEL=\"${LOG_LEVEL_WARN}\" ;;\n    --log=ERROR) LOG_LEVEL=\"${LOG_LEVEL_ERROR}\" ;;\n    *)\n      log_error \"Unknown argument: ${arg}\"\n      exit 1\n      ;;\n  esac\ndone\n\nexport LOG_LEVEL\n\nlog_info \"=== Kubernetes Homelab Bootstrap Wrapper ===\"\nlog_debug \"ROOT_DIR=${ROOT_DIR} LOG_LEVEL=${LOG_LEVEL}\"\n\n# ----------------------------------------------------------------------\n# Phase runner\n# ----------------------------------------------------------------------\nrun_phase() {\n    local phase_script=\"$1\"\n    local phase_name=\"$2\"\n\n    log_info \"Running Phase ${phase_name}: $(basename \"$phase_script\")\"\n    log_debug \"Phase script path: $phase_script\"\n\n    if [[ ! -x \"$phase_script\" ]]; then\n        log_error \"Phase script not found or not executable: $phase_script\"\n        exit 1\n    fi\n\n    \"$phase_script\"\n\n    log_info \"=== Phase ${phase_name} complete ===\"\n}\n\n# ----------------------------------------------------------------------\n# Phase 00: Host Tooling\n# ----------------------------------------------------------------------\nrun_phase \"${BOOTSTRAP_DIR}/00-host.sh\" \"00\"\n\nif ! command -v kubectl >/dev/null 2>&1; then\n    log_warn \"kubectl not found yet. Will verify after k3s installation.\"\nelse\n    log_info \"kubectl already available: $(kubectl version --client -o json | jq -r '.clientVersion.gitVersion')\"\nfi\n\n# ----------------------------------------------------------------------\n# Phase 01: Cluster Setup (k3s)\n# ----------------------------------------------------------------------\nrun_phase \"${BOOTSTRAP_DIR}/01-cluster.sh\" \"01\"\n\nif ! command -v kubectl >/dev/null 2>&1; then\n    if [[ -x /usr/local/bin/k3s ]]; then\n        sudo ln -sf /usr/local/bin/k3s /usr/local/bin/kubectl\n        log_info \"Created kubectl symlink to k3s binary.\"\n    else\n        log_error \"k3s not installed or missing at /usr/local/bin/k3s.\"\n        exit 1\n    fi\nfi\n\nlog_info \"kubectl is now available: $(kubectl version --client -o json | jq -r '.clientVersion.gitVersion')\"\n\n# ----------------------------------------------------------------------\n# Phase 02: Infrastructure\n# ----------------------------------------------------------------------\nrun_phase \"${BOOTSTRAP_DIR}/02-infra.sh\" \"02\"\n\n# ----------------------------------------------------------------------\n# Phase 03: Smoke Tests (currently commented out)\n# ----------------------------------------------------------------------\n# shopt -s nullglob\n# SMOKE_SCRIPTS=(\"${BOOTSTRAP_DIR}\"/03-smoke*.sh)\n# shopt -u nullglob\n# if [[ ${#SMOKE_SCRIPTS[@]} -eq 0 ]]; then\n#     log_error \"No 03-smoke*.sh scripts found\"\n#     exit 1\n# fi\n# for script in \"${SMOKE_SCRIPTS[@]}\"; do\n#     run_phase \"$script\" \"03\"\n# done\n# log_info \"=== Phase 03 complete: all smoke tests passed ===\"\n\n# ----------------------------------------------------------------------\n# Phase 04+: Post-smoke stages\n# ----------------------------------------------------------------------\nshopt -s nullglob\nPOST_SCRIPTS=(\"$BOOTSTRAP_DIR\"/04-*.sh)\nshopt -u nullglob\n\nif (( ${#POST_SCRIPTS[@]} > 0 )); then\n    for script in \"${POST_SCRIPTS[@]}\"; do\n        run_phase \"$script\" \"04\"\n    done\nelse\n    log_warn \"No 04-*.sh scripts found to run\"\nfi\n\nlog_info \"=== Kubernetes Homelab Bootstrap Complete ===\"\n"}
{"type":"file","path":"docs/README.md","role":"unknown","criticality":"unknown","bytes":0,"sha1":"da39a3ee5e6b4b0d3255bfef95601890afd80709","truncated":false,"content":""}
{"type":"file","path":"helm/infra/operators/cert-manager/values.yaml","role":"helm-values","criticality":"medium","bytes":277,"sha1":"08021b2039754af906433d16f6a526bf8c040b7d","truncated":false,"content":"# Ref line 97\ncrds:\n  enabled: true\n  keep: true\n\n# Ref line 192\nnamespace: cert-manager\n\n# Ref line 290\ndns01RecursiveNameservers: \"1.1.1.1:53,8.8.8.8:53\"\ndns01RecursiveNameserversOnly: true\n\n# Ref line 321\nextraArgs:\n  - --acme-http01-solver-nameservers=1.1.1.1:53,8.8.8.8:53"}
{"type":"file","path":"helm/infra/operators/cloudflared/k8s/10-secret.sops.yaml","role":"k8s-manifest","criticality":"unknown","bytes":2151,"sha1":"a221b40867f06545e74765d320cdd306a52aa38c","truncated":false,"content":"apiVersion: isindir.github.com/v1alpha3\nkind: SopsSecret\nmetadata:\n    name: cloudflared-tunnel-secrets\n    namespace: cloudflared\nspec:\n    suspend: false\n    secretTemplates:\n        - name: cloudflared-tunnel-secrets\n          stringData:\n            cert.pem: ENC[AES256_GCM,data:P0uMQ3yeRDzkUmqJGXT5wMt/YzTiFvutCZ11x51D9oPy9gBuHAqEl7RRu12x5O/wg3z84eHVfk+W3l2XQ+A/XEptwvDangrQ60bzi/p05M7v4KcPATo/EuqiCCK2HM6RQNlQHzldmHBBMKNFIEmZTfyVop8RctWhCmPFXoKlUwruOBMsfOPWNyVZkR71tLWEv4E26u4riPZ+8UnnS1jSs57kdCz2mPkCwVASm7cBsZi1N8ayYHRvaExXpc2Mmuh1cX2mVQ4oVh5+1AjXSIcyj82m0rkMLQ1++ZFlX0ynIG+oEwiBr3vyhxjzaBcvDS1X8d231QM+DPuVIeyCZhKFd4lYBmD2fqfAE/8=,iv:BciDM03EWitSA6jwMFVqGs2jYsdx6GGChrUVT4rQjZw=,tag:vucXs7yWdTm6lICgLjjqVw==,type:str]\n            credentials.json: ENC[AES256_GCM,data:j35xzgBghYaffSmquPVxrCBgpY8yYE4aim3OJt3kZtwLJZj59+N/ih99eAXyJCShd3T23WGaa+8oIwnxQcxjXRtlsd/HNvVrUlXiIgwpdJZ//2EgWSenMuvFmizmC/HKgcC8od7s2gJXXdlBvoGymBrrlS74OqGdMoDnEOeGRsyDOoV2+RGloBPes1tRmZyaBQvCJdWmtEb1sE4ex6HdKU75xTgcgX6BBQEBKCxs0Ts=,iv:Rn8IRlpTTE/S3KblN7Tc5UT4ltlwaRS9YpMunnTWYC4=,tag:N7rWWMqCuZ/2g0hEvstklA==,type:str]\nsops:\n    kms: []\n    gcp_kms: []\n    azure_kv: []\n    hc_vault: []\n    age:\n        - recipient: age1pqkt694pps8jf408tmn8gg6692mpvh23nw9jvqsfxayy9fjth9msps9fcu\n          enc: |\n            -----BEGIN AGE ENCRYPTED FILE-----\n            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSB3SXBxMytWaFFKbGwyQ3Zn\n            dkt3TUgrQW9HYU5HcTBVNUpmYi9BVWNPdXpVCkxpc2JQcThHdGFLZ1V3bmlpQnc2\n            SlliVUJlaDkwaGtPM1NaUjRvK1lqeE0KLS0tIFhTekV3NG9VL2RSZEJqUVdCZ3dl\n            Tk04djdaU093ZnIxSGdUMENUZmFrTkEKpuGtfebfVPlugZGvDnS39mM3R8ArF3TR\n            7w1N2qFzz0TmvZE6Hh+iuKketVR71ONxORlxdcAy3IzmLXHidHIS+w==\n            -----END AGE ENCRYPTED FILE-----\n    lastmodified: \"2026-01-08T08:36:36Z\"\n    mac: ENC[AES256_GCM,data:gkXKTCKJcZYxqyPHHZ++aw9oiUm0IVckGErVhCDhp/y9+z67nl9zY+4lW4EPn1tURyCHDV5CN9Ajxb74zGaBW+/cYC83y6WjNmdcnGX6QhYEe3fKSnLxesFbCG4eCYN/rqVbhJ1pLqBPxJGxQQQUfjof1qW71Qbknke5A/T8L0s=,iv:IGM9Z/ZrVhY230vI5kRETYtBV38htLY+6pwmRFR3Hug=,tag:Qu9FnuN8j16lVwmUXp1Rsg==,type:str]\n    pgp: []\n    encrypted_regex: ^(data|stringData)$\n    version: 3.9.4\n"}
{"type":"file","path":"helm/infra/operators/cloudflared/values.yaml","role":"helm-values","criticality":"medium","bytes":238,"sha1":"153c364a3acac99eecb2ee7b857592dd64105344","truncated":false,"content":"tunnelSecrets:\n  existingPemFileSecret:\n    name: \"cloudflared-tunnel-secrets\"\n    key: \"cert.pem\"\n  existingConfigJsonFileSecret:\n    name: \"cloudflared-tunnel-secrets\"\n    key: \"credentials.json\"\n\ntunnelConfig:\n  name: traefik-smarthome"}
{"type":"file","path":"helm/infra/operators/sops-operator/values.yaml","role":"helm-values","criticality":"medium","bytes":171,"sha1":"da20d7881ba755226aaf23da1984e0457488fdd8","truncated":false,"content":"secretsAsFiles:\n  - name: sops-age-key\n    secretName: age-key\n    mountPath: /etc/sops-age-key\n\nextraEnv:\n  - name: SOPS_AGE_KEY_FILE\n    value: /etc/sops-age-key/key.txt"}
{"type":"file","path":"helm/infra/operators/traefik/Chart.yaml","role":"helm-chart","criticality":"unknown","bytes":399,"sha1":"4b2dd50a20614543582213057e02c78818eea9db","truncated":false,"content":"apiVersion: v2\nname: traefik\ndescription: \"Local Helm chart for custom Traefik templates and overrides\"\ntype: application\nversion: 1.0.0\nappVersion: \"v0.38.0.1\"\n# appVersion: \"v3.6.5\"\nkubeVersion: \">=1.24.0-0\"\nhome: https://github.com/traefik/traefik-helm-chart\nsources:\n  - https://github.com/traefik/traefik-helm-chart\nkeywords:\n  - traefik\n  - ingress\n  - proxy\n  - load-balancer\n  - ingressroute"}
{"type":"file","path":"helm/infra/operators/traefik/k8s/post-crd/20-certificates.yaml","role":"k8s-manifest","criticality":"unknown","bytes":615,"sha1":"88a73cf25048bd0d46c4ceb1d5d0e829d5105f13","truncated":false,"content":"apiVersion: cert-manager.io/v1\nkind: Certificate\nmetadata:\n  name: traefik-internal\n  namespace: traefik\nspec:\n  secretName: traefik-internal-tls\n  duration: 2160h\n  renewBefore: 360h\n  issuerRef:\n    name: clusterissuer-lan-smarthome\n    kind: ClusterIssuer\n  dnsNames:\n    - traefik.smart.home\n\n---\napiVersion: cert-manager.io/v1\nkind: Certificate\nmetadata:\n  name: smarthome-wildcard\n  namespace: traefik\nspec:\n  secretName: smarthome-wildcard-tls\n  duration: 2160h\n  renewBefore: 360h\n  issuerRef:\n    name: clusterissuer-lan-smarthome\n    kind: ClusterIssuer\n  dnsNames:\n    - \"*.smart.home\"\n    - \"smart.home\""}
{"type":"file","path":"helm/infra/operators/traefik/k8s/post-crd/40-ingress.yaml","role":"k8s-manifest","criticality":"unknown","bytes":907,"sha1":"9009fe1b075cac1b68bf1cd9ce7602ae23a28f34","truncated":false,"content":"apiVersion: traefik.io/v1alpha1\nkind: Middleware\nmetadata:\n  name: redirect-root-to-dashboard\n  namespace: traefik\nspec:\n  redirectRegex:\n    regex: ^https://traefik\\.smart\\.home/?$\n    replacement: https://traefik.smart.home/dashboard/\n    permanent: true\n    \n---\napiVersion: traefik.io/v1alpha1\nkind: IngressRoute\nmetadata:\n  name: traefik-dashboard-internal\n  namespace: traefik\nspec:\n  entryPoints:\n    - websecure\n  routes:\n    - match: Host(`traefik.smart.home`) && (PathPrefix(`/dashboard`) || PathPrefix(`/api`))\n      kind: Rule\n      services:\n        - name: api@internal\n          kind: TraefikService\n    - match: Host(`traefik.smart.home`) && Path(`/`)\n      kind: Rule\n      middlewares:\n        - name: redirect-root-to-dashboard\n      services:\n        - name: api@internal\n          kind: TraefikService\n  tls:\n    secretName: traefik-internal-tls\n    # secretName: smarthome-wildcard-tls"}
{"type":"file","path":"helm/infra/operators/traefik/k8s/pre-crd/10-secret.sops.yaml","role":"k8s-manifest","criticality":"unknown","bytes":8554,"sha1":"b46acf7f8d661a0e67bd27f5d58abe4f4d268e4c","truncated":false,"content":"apiVersion: isindir.github.com/v1alpha3\nkind: SopsSecret\nmetadata:\n    name: local-certs\n    namespace: traefik\nspec:\n    suspend: false\n    secretTemplates:\n        - name: local-certs\n          stringData:\n            local-ca.crt: ENC[AES256_GCM,data:us3l94ClKprnXDrvdx/glSo9ijyn5kcc7xfxLsf5kacmGZ/M4rhdEvg8EHBp0xe0rWvETdsEBTvscjBEwhqOjRol0tey7Rzoz+P9NYmM12EXzjPMdiDaOVmllX0okn9S2O08D9KIu43htvMUnT66RgzeGnJwN6QguWb+NOsC/3PsDMGVDbyGKB+chq0Ne9Yl5VCM+/oO8/pI4Afit32U1oEUXUUxQLZ8N8YZ1AHj4LqAgzpxww9dr81T/MgfZmVyhR0uBBb4QG5Bfb30eH8qx5ffxkPO6fCdX7CYemtV2nEDiHP0d+GukemWPgdLnBTKJCd83YKNaf38HmGsg4qmodkOl+LcaP5pzo9tRjf54CakdLUN7MpXS+W026f2sVVJKVLduQyOPUnC4QIfQgdqv0vbEIeuotqJC4vcRiM0E45Uw4Gm8wKECIxALfmCEmR8U57itKGfxgSyGvfehmyv1eVvoeHF3auhJTFMyTLBTOYAfFsHOtRP1Df4WPPVcqLuLQuN5tBd++bzxUE7sH2pRPbmdrVWobNR14CBqc8yb+ZpBwTH/eS8SUKsU5iLfXmfxLx66I/kzZMYR05EMstkv2vbXClKEMpGZNgyJJ27cb4EFpRfL7EOg5xYRHdyhjoV3X6FGR2lTFhM/M1IssU4Z6EoP9SZ204TLfq7SANZfpIJujvjtjB3rcXFp7sUuZ7Nv+Jz8L2CuT/8PFDWOcZOCpz1pZoqN8hii8fRUIwMmlfD/oH9aqrXHfaQMQ3YkjuDUQlzu/PXV/KD7Kd0fj0qul0356Oaw2cflDMYdDuZEImsMXesibWnZcfKyasZ28YpkgKk15oemgQwJxU+UeM85PRh/ie9sv2S2U6l2kGKJVgB4uswrFMjN+4oUtC6AZxCvbSeA6c2nhCDhxf84uqy0dcVWfHFcT97GHgggTpY3sC2szZOkbOdmqwN85NZ8zf2txA+/Ac/qde4nKXXk3UJVLFGFc/GTrdRSrHcK/MvfCwvxGhwMffz3J07EvdPd7gwdnY+j6x45nKN2A5OHD7sTlGfmB7OkrRMQFmV9ZZN7OVlqhPa0FgonnOlAHUTdzhONkfZGl1Go6jDfD1vtnsFpZzrnqu6vHSjrDZl7ARSNvQVTtCBusQ+ynCLN3QCAyK/8ffiQ3WExMM1eF3vBkxpqJ/kadr3J0xsGezUIWCu4ber2jhuxApWFRTyvJ3QTB0Ax6A3lRJkWdO31FTQaETBb3OQBjTPvBXpX3bC5tQ37TNhwoZRHGOzjhjnDqCCJ6Bq+UOCzW3GkmfESk1YlpFBf/p8x9B4zlgZYXvAB7B7EtxKb15ZTGrBVjYD6HJxW+TwR4xnWqIOIhiRWINgzYJIlHGUWtl0w+P8C6tWlZ5KPq8gD9lsp+43BWQgn8+UO0L2rbp5BCQWC71iU8Pzu7XJz46qp5lnE5RPt66DZ/tzlCSJYrNSmy98PIYD/+1RV15hEXKCuikLccmSO5pXnxhLhWk9JrOP9TTeq9Jg1fpfQeNZrBavvJD3Kocp6AlTVPB0NiAI88lQ1PoJ1LhD5SkHjjmxph+LImIdQbE92U6lBgS+07jIH5li/79YhpJ7/R9FKhN0P7NR5jiLa7YZxhBTOt0lzNNmYG0+xPKRbZXXtVTD6764dg9OzBn3pJMCSO7PaUKekYCwjXMm5bjb0pf0wPS6w3UH3dyF6HgEj4pgpaPRvdXox0rbeg+KsFUKzxyl/zcuVgTK8//mWLD1YudA+rX/DOYoFqyNhupX0LRv8ejRkdvxYUTzn+MAbyge1MCLMY7W0inigAPGtn9BEfNxwzeBdC+U1LyvnIMis2iTxyBa0bQ9H4jV7MdbE+vM/HKB+A5/Xjx231OaespLe9TG4kMUsDKVPv0qZv+jnslfBm1lEo1ntqow/UEcgINOv2FQnuhTlanj2PVcq9rDwdLpU5vudMQXWgLlWykWr/YYcGjcY3Tm1mGGXzWroh4m3aro/ALaedfYj3fWT12xbFq6dbSuMMG0zZu4G1Qp7toeVjzfCXTQ4XNaXkCi4rQcx6pycCcNveR5ADt/abROtUO7+a/ttM7QAm92jFgiT+ncc4VLuap5Ea6YOiSbVraoEWVELqlhSZKL25RfRZinIC+I+W1PsprtYLdor2TBcxUyaziMO2YQsb3OrRECF4RQCwrmZ4FnNueC8oX8IksKAcSSyRFIrpmlpoMuWGUcQdvJqbhYCr+bD3+rDMrA75ci7R7cucYPK6J76Fr2CJO2bj/ohgchuCJ3erVe6PH/BamIr40pvrOwdsV+Tec/zP6ORw+QzFmbRF9mCyqA80xtAmXfv1EY0tdgaHhTwuw+vIqYxxErC8cgd8hwzRhaYUSGPkCk3sASNo+XyV0DAbq7u2Sw5ocZxcJ5tikyVQjJLcrUKzgt8ZxWPMfGs394ySUUTQf1Hm4cZk2Y/gpeEVcbvGUkA2vQm5HlkZlfQAE4bMp0EHVxpXMkLLTxo6zDAe+z43ZUYtdc6//1ToT4ANvk/jicYaNjzvjkfeN5c39iuwSGBfRF1fpH3g57rF5o6MlDEis=,iv:JTH8Fgg4JJlyJHV7ldAVwf6boIceKJZd5XU5i4qUnDc=,tag:YAz5iqX9IIHSDtuku+PNgw==,type:str]\n            local-cert.pem: ENC[AES256_GCM,data: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,iv:3APa9wiJGSdLPFQCYuVtBdMnza1D6WBZ/4IU9ytPX9Q=,tag:Yyy5tIwOpC/478zyf7FwyA==,type:str]\n            local-key.pem: ENC[AES256_GCM,data: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,iv:yjIcuhMQ9d1JdTT0eZ4qPTJ/Us7uzck0NZJ2K51zsck=,tag:HVVQBIRo9c/nMiE/xM2WvA==,type:str]\nsops:\n    kms: []\n    gcp_kms: []\n    azure_kv: []\n    hc_vault: []\n    age:\n        - recipient: age1pqkt694pps8jf408tmn8gg6692mpvh23nw9jvqsfxayy9fjth9msps9fcu\n          enc: |\n            -----BEGIN AGE ENCRYPTED FILE-----\n            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBkVXZIVGlTdWJMdTlRSHNs\n            ZVIwWi8yMlY0aTBUdFBJVGVjR3E0bHZHN0FnCklTVFFBY1ZHeFJnQVlsT2lBYWRF\n            aFRrSXhGNWYrRkVnWnZkRWlTRy9MYTAKLS0tIFgvdHE2dEJIWjlhSWNzYXEwS3VP\n            SVJhRk9JSDJGL0J4TjdZVFg0YjdHK1UKTMiLbZxf7P1A6FW5m0J4Qb9/pCIXXKGT\n            skxs5whsXdPnFq88z1ma2BEOqwlHyPmTJb8i54kR/4WNnLiIzQzdfQ==\n            -----END AGE ENCRYPTED FILE-----\n    lastmodified: \"2026-01-08T08:36:36Z\"\n    mac: ENC[AES256_GCM,data:81yMpsh1Lrlxn7iDz23a/OShPjtxCOhvh9zzxegvL2QwrbR5CDaW8emM70nNeaJoHMMjM/E7MQGOiTO3MSomByyU0NA7Ws1m6pp3/lP3gWHyzwfunbjHGrUWfPCcHEhDBxNx2NZK0nNVIuV7itT0oLgLMTJ5VVMaylvUyK7UbHY=,iv:/nYaJvV1CcAyQWnrnn7gFhLJoSYYTLvKE1iTaR7uX8M=,tag:f/ctqY+V7A9GvHLrE3+Arw==,type:str]\n    pgp: []\n    encrypted_regex: ^(data|stringData)$\n    version: 3.9.4\n"}
{"type":"file","path":"helm/infra/operators/traefik/templates/dynamic-configmap.yaml","role":"unknown","criticality":"unknown","bytes":305,"sha1":"603a62efe2dbe80c955d5f7b980e63e5fae69c87","truncated":false,"content":"{{- with .Values.dynamicConfig }}\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: {{ .name | default \"traefik-dynamic-config\" }}\n  namespace: {{ .namespace | default \"traefik\" }}\ndata:\n{{- range $filename, $content := .files }}\n  {{ $filename }}: |-\n{{ toYaml $content | indent 4 }}\n{{- end }}\n{{- end }}"}
{"type":"file","path":"helm/infra/operators/traefik/templates/plugins-pvc.yaml","role":"unknown","criticality":"unknown","bytes":434,"sha1":"75af121006dcba842bfd2f8d2d62754110d2cd45","truncated":false,"content":"{{- with .Values.pluginsPVC }}\n{{- if .enabled }}\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: {{ .name | default \"traefik-plugins-pvc\" }}\n  namespace: {{ .namespace | default \"traefik\" }}\nspec:\n  accessModes:\n    - {{ .accessMode | default \"ReadWriteOnce\" }}\n  resources:\n    requests:\n      storage: {{ .size | default \"1Gi\" }}\n  storageClassName: {{ .storageClassName | default \"local-path\" }}\n{{- end }}\n{{- end }}"}
{"type":"file","path":"helm/infra/operators/traefik/values.yaml","role":"helm-values","criticality":"medium","bytes":6653,"sha1":"62a43cd9bad582ee1fb09dce5845810035c23ccc","truncated":false,"content":"deployment:  # Ref line 19\n  additionalVolumes:  # Ref line 67\n    - name: dynamic-config\n      configMap:\n        name: traefik-dynamic-config\n        defaultMode: 420\n    - name: tls-certs\n      secret:\n        secretName: local-certs\n    - name: plugins\n      persistentVolumeClaim:\n        claimName: traefik-plugins-pvc\n\ningressClass:  # Ref line 116\n  enabled: true\n  isDefaultClass: true\n\nexperimental:  # Ref line 127\n  plugins:\n    traefik-real-ip:\n      moduleName: github.com/soulbalz/traefik-real-ip\n      version: v1.0.3\n\ningressRoute:  # Ref line 202\n  dashboard:  # Ref line 203\n    enabled: false\n  healthcheck:  # Ref line 224\n    enabled: true\n    entryPoint: websecure\n\napi:  # Ref line 195\n  dashboard: true\n\nadditionalVolumeMounts:  # Ref line 420\n  - name: dynamic-config\n    mountPath: /etc/traefik/dynamic\n  - name: tls-certs\n    mountPath: /etc/certs\n    readOnly: true\n  - name: plugins\n    mountPath: /plugins-storage\n\nlogs:  # Ref line 425\n  general:  # Ref line 426\n    level: DEBUG\n  access:  # Ref line 478\n    enabled: true\n    bufferingSize: 100\n\nglobal:  # Ref line 764\n  checkNewVersion: true\n  sendAnonymousUsage: false\n\nadditionalArguments:  # Ref line 787\n  - --serverstransport.rootcas=/etc/certs/local-ca.crt\n  - --providers.file.watch=true\n  - --providers.file.directory=/etc/traefik/dynamic/\n\nports:  # Ref line 799\n  # web:  # Ref line 832\n  #   redirections:  # Handled by Cloudflare SSL; Breaks cloudflared tunnel\n  #     entryPoint:\n  #       to: websecure\n  websecure:  # Ref line 882\n    forwardedHeaders:  # Ref line 924\n      insecure: true\n      trustedIPs:\n        # Cloudflare IPv4\n        - 173.245.48.0/20\n        - 103.21.244.0/22\n        - 103.22.200.0/22\n        - 103.31.4.0/22\n        - 141.101.64.0/18\n        - 108.162.192.0/18\n        - 190.93.240.0/20\n        - 188.114.96.0/20\n        - 197.234.240.0/22\n        - 198.41.128.0/17\n        - 162.158.0.0/15\n        - 104.16.0.0/13\n        - 104.24.0.0/14\n        - 172.64.0.0/13\n        - 131.0.72.0/22\n        # Local / RFC1918\n        - 127.0.0.1/32\n        - 10.0.0.0/8\n        - 192.168.0.0/16\n        - 172.16.0.0/12\n    tls:  # Ref line 944\n      enabled: true\n      options: default\n  mqtt:\n    port: 1883\n  mqtt-secure:\n    port: 8883\n    tls:\n      enabled: true\n  wss:\n    port: 9001\n\ntlsOptions:  # Ref line 992\n  default:\n    minVersion: VersionTLS12\n    cipherSuites:\n      - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256\n      - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\n      - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384\n      - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384\n      - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305\n      - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305\n      - TLS_AES_128_GCM_SHA256\n      - TLS_AES_256_GCM_SHA384\n      - TLS_CHACHA20_POLY1305_SHA256\n      - TLS_FALLBACK_SCSV\n    curvePreferences:\n      - CurveP521\n      - CurveP384\n    sniStrict: true\n\ntlsStore:  # Ref line 995\n  default:\n    defaultCertificate:\n      # secretName: traefik-internal-tls\n      secretName: smarthome-wildcard-tls\n\n# persistence:  # Ref line 1062\n#   enabled: true\n#   name: plugins\n#   size: 1Gi\n#   accessMode: ReadWriteOnce\n#   storageClass: local-path\n#   path: /data\n\n# ----------------------------------------------------------------\n# Custom template sections\n# ----------------------------------------------------------------\n\npluginsPVC:\n  enabled: true\n  name: traefik-plugins-pvc\n\ndynamicConfig:\n  name: traefik-dynamic-config\n  files:\n    serversTransports.yaml:\n      http:\n        serversTransports:\n          default:\n            insecureSkipVerify: true\n            rootcas:\n              - /etc/certs/local-ca.crt\n    middlewares.yaml:\n      http:\n        middlewares:\n          middlewares-basic-auth:\n            basicAuth:\n              realm: \"Traefik Basic Auth\"\n              usersFile: /shared/www/.htpasswd\n          middlewares-oauth:\n            forwardAuth:\n              address: \"http://oauth:4181\"\n              authResponseHeaders:\n                - X-Forwarded-User\n              trustForwardHeader: true\n          middlewares-rate-limit:\n            rateLimit:\n              average: 100\n              burst: 50\n          middlewares-high-rate-limit:\n            rateLimit:\n              average: 200\n              burst: 100\n          middlewares-ultra-high-rate-limit:\n            rateLimit:\n              average: 400\n              burst: 200\n          middlewares-internal-ipallowlist:\n            ipAllowList:\n              sourceRange:\n                - \"10.0.0.0/8\"\n          middlewares-secure-headers:\n            headers:\n              accessControlAllowMethods:\n                - GET\n                - OPTIONS\n                - PUT\n              accessControlAllowHeaders:\n                - \"*\"\n              accessControlAllowOriginList:\n                - \"*\"\n              accessControlMaxAge: 100\n              browserXssFilter: true\n              contentTypeNosniff: true\n              contentSecurityPolicy: \"frame-ancestors 'self' https://*.brandonhowlett.com https://*.smart.home\"\n              customResponseHeaders:\n                X-Robots-Tag: \"none,noarchive,nosnippet,notranslate,noimageindex,\"\n                server: \"\"\n              PermissionsPolicy: \"camera=(), geolocation=(), microphone=(), payment=(), usb=()\"\n              forceSTSHeader: true\n              hostsProxyHeaders:\n                - X-Forwarded-Host\n              referrerPolicy: same-origin\n              stsIncludeSubdomains: true\n              stsPreload: true\n              stsSeconds: 63072000\n          middlewares-real-ip:\n            plugin:\n              traefik-real-ip:\n                excludednets:\n                  - 1.1.1.1/24\n    middlewaresChains.yaml:\n      http:\n        middlewares:\n          chain-basic-auth:\n            chain:\n              middlewares:\n                - middlewares-secure-headers\n                - middlewares-rate-limit\n                - middlewares-basic-auth\n          chain-no-auth:\n            chain:\n              middlewares:\n                - middlewares-secure-headers\n                - middlewares-rate-limit\n          chain-hrl-no-auth:\n            chain:\n              middlewares:\n                - middlewares-secure-headers\n                - middlewares-high-rate-limit\n          chain-oauth:\n            chain:\n              middlewares:\n                - middlewares-secure-headers\n                - middlewares-rate-limit\n                - middlewares-oauth\n          chain-hrl-oauth:\n            chain:\n              middlewares:\n                - middlewares-secure-headers\n                - middlewares-high-rate-limit\n                - middlewares-oauth"}
{"type":"file","path":"helm/infra/static/issuers/k8s/10-secret.sops.yaml","role":"k8s-manifest","criticality":"unknown","bytes":9923,"sha1":"db0b0c336488291f636db654ac402287aa4747a4","truncated":false,"content":"apiVersion: isindir.github.com/v1alpha3\nkind: SopsSecret\nmetadata:\n    name: cloudflare-api-token\n    namespace: cert-manager\nspec:\n    suspend: false\n    secretTemplates:\n        - name: cloudflare-api-token\n          stringData:\n            api-token: ENC[AES256_GCM,data:ny2VzP6pBBokk5KIH5GqUZGo2ZvBn77hHAv66UCWw7HwIiLCMJZ/hA==,iv:qFHmd9uglZvyR/bNtvzv5MEXjp8YLfLyFFQpRkbD2ak=,tag:lySR3gm9NqwLlCoxnvz2yw==,type:str]\nsops:\n    kms: []\n    gcp_kms: []\n    azure_kv: []\n    hc_vault: []\n    age:\n        - recipient: age1pqkt694pps8jf408tmn8gg6692mpvh23nw9jvqsfxayy9fjth9msps9fcu\n          enc: |\n            -----BEGIN AGE ENCRYPTED FILE-----\n            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBTRVlOWi9MVXJNR1Azc0Fs\n            RW5FZ2tMa09IY1o3WGNvbVNMVEhMMmxCd1hrCnVLdWJRUU1jQ2VpN2lxVjhZaTI2\n            eDZTV1JLQzZWRmREeFZZQzY3d2xNcGMKLS0tIFlTaUlOYWlERHM3djQ2a2ZOTkVp\n            WDJVaEdJTzZNVkJjMTNHYW5tUC9tSDgK3q6lr/0LjclXr45y3CqD5WDgHTX1yhzy\n            j7wthuY1QKJkmPWYG7elEPORObt4ZNV/6xunppranNjH6rM08ZzgWQ==\n            -----END AGE ENCRYPTED FILE-----\n    lastmodified: \"2026-01-08T08:36:36Z\"\n    mac: ENC[AES256_GCM,data:ZkqWzePPCH0hQSxSg+1PLyFe/ZElXFTG+Fwc7V4pcWTNOTDNgbjzuqRyKlBkpQBb0gJOYAcNxxKrdnbTcIfAwePQ9J1x3Tw2Ew0nV+UWJ3SyuLSxg5SAPC2n8TEIwmfuzufse4C/ugM2Zyb25+QCaQQtHFulJ8NVFHSngx4mhn8=,iv:dg7qHFxS2dVC8s8T2SRZ/4CR2kRsYHZfayYpAcg0Nw4=,tag:xYtLDMuMNqy3cnZcgoINLA==,type:str]\n    pgp: []\n    encrypted_regex: ^(data|stringData)$\n    version: 3.9.4\n---\napiVersion: isindir.github.com/v1alpha3\nkind: SopsSecret\nmetadata:\n    name: smarthome-root-ca\n    namespace: cert-manager\nspec:\n    suspend: false\n    secretTemplates:\n        - name: smarthome-root-ca\n          stringData:\n            tls.crt: ENC[AES256_GCM,data:GdLF+uZ0Nrp8gOVi9QOQd/Kq1JSfiVqmdsJCQFGzA9QaJ+OItQL4sNBEmRKaLWlOUyA+fcHtAwKr6kJIftdjZGEETl3Ecl7aKaXpQNmp6S2Ctkr+/JuXR12IJW7X+iusno/3yLfD1kAx7wEeVTQv7hJduxg636i69zRY93Cotp1m8NqCilDF0hWXrTMU5e5xBKrjJFhzp9ajqWz5QdAnmXW3cBAeKQEHrf0v50ISq21C+9UmDIsPivOtUYI6xq3/J1XMcH/yLxlx7bFhoTshyGZVpQO6IAgCcpChnqyDBVNjNe7QEc8c6CakqbGuHCim3or7tYE/Y+fbxovhAMW8+wgxW743MvOz8rnuJKkqRE8j3OLeSkD/2oD05oQ97QZpPCi+0KHT/eOAZBRIl5mUGSECY/wmxX7yHwgj9J0yQUx7MYOHKL15qDwQFTodNoGp9xGIGR+CEPIScu/QKk7qJ87tgXDQe8LY0YmsZfHD+GPVX61kROswqRRToCEGdIsIaje27BsLupjVFE3XXwuT5e39n1mr+e0aGNfcV0j4YBtWhtM05h4I7tk1l+hNtPBtM0YpLQ9aXanjkg723n0J1PYGmfdeU3bj4DlQzlCjNJw9NUl2m/KpCEFe2WeLwqR+YXd/JJrzKUyCjTOj0q+tC6m9Cjr/tt4bqnwRgdcUNxbd/UHyipDYDiIImoXQdTZGle2ea9b2RNiE1YFPNhygrtXq1oPvHFIZZfplJp2BqTFQAJApkZl+MNTob1SPQMUlV4y5szPRikSQHmy45yHjGVhvAYlHm9wr4zyEEzLEXF5nYQq9mB3DWA7NuTHk1wlOW3v4zLrEH+qsT7WkjTjxtNOtmLj0WXtJ4n+kpXkRKgmZP1vjsDAF0mylXDEE5/C0yNyOF3FzVanN+rokJZ3w5ataa+GSQx660WLAukFC1rLPmGyB9uPd3iPD0oB0n5aoWrrwtxkDPYgUMgNd5hlzoaHrJW8XTQ6KW5RLpy+ihGzPeYiHz1DzM9Xg3oyMbg7S2VdTh4BCIqD+I2KwaVqsgB27gm+NjcvaBPsIxbeYjIHpejpOIk5/okVeX7Vaark3wVq7HLj53jfjfsq4z7t7UrD7DzPmkM7Bg3bXvLoJVGk7EqaFuMs4S0mtMTy/XYSVmmQAToi7jDsQkyXnZs5AUdhcyNaTeMa7zMVkBfb3Jp+Yng720u0/Nq96NS+s9KHhuwfmkWS2EBcRSPXAgETP9cSftcAhyTL7xqCN/6X+4zoCk/kfkF3MKcW2pYIUieNTwvlL+RRlB/DZKRd5dLITS9mL3xq/sfowdI+9ZMje0+WFYSE/foOPu83ohp3FCtiPnuWBAsctyXQNaceMIUKiWrSZDfBnI6yOARkNed3+T8tT3FdilcB0TndiQqV0sybrR0lIY9hY90MM7pwUMeWLM6Kkd57scvj71Z/pbH5MOS/TOBZEIS7bsLvu/qgwM7GkWaNkTWNsvMX+yTICr866by1by10OO1OafPypBYrIhlaE7ZgUNAsWqLKTw3gNA5zUM3HuweArPcW8orBoeY3L6llUxy0fCH9RKprZgVN8SDmd2biNo2RbsazDcwp+7YZhc5FQJU3InfgpIf9liVtZJtU7NqvQ6vdwn/cAulwzPSGzsGQ9P5P272zEbdNOksKGxipOJl/Tvt8b7ZQEqsDHr4N9Da8CHaY2ZzjRBMKj/1B8VSNTbr/B8dmNaKTk9QLpVdkB/jxr8Nw2vJJWeTBKWCreD+L5zXhJGkfRE0ZJ01auXzbB/LfSRhccxYV1VfxRi7PJCJnAnc4ecVWe3sRpFBLJm5Dt07sAgTZkcXXz4b47Z0KeivQeSZDBUmSK0bo0WYYBdaTF3VG/hpET8uL0QtXpwLuui0NlqRrDZQ8/Fw+I9g1Nge1HrI1qLe0D61R5zRMKO2xL3p/Jfg4sq52wFHwxxg3uMzMvhZ2hoqtrdv944jwPzvPid21HYQPzyqYPL7zIR5cV50XVC9XxQbUPs96z1eABpQjfjSVzT7Kv2IndK5Ve5K3icTk9SB876mHA20udnU51t7l0uKSNxe1cs5gPXEihVcT+i69sj0hyOmrLiy+QKSfUbSHcpjcuVZvaYXP3TDxkh+VBgtus0/EwOpLIw6GIWX+kIrctUL7OEuxAbNdwh7Kuc2OjUijEshvh07ogL1na1r2u2DpZ17KvYOFK7nFK/4yhjKZ1HC4w3y8ZK+nhmyOdIo1P9rR2O0S2GBcbqgBffksvRkBQiNBZ3pH/1RORQYsG0hvojCWeYaL6k2UbMnQyEEUrVR09dnmSA3J7T6vvvOROGRYbOAWCnRzjvboWsUJYqDkTOw+N+YpSgCTc6gH7lUFumAwnoXZH5Ot3bVjutBb4J1J72pQS28mKawKhboyC0RPO1PZJrCktb26NrgxXj8bGCLtkRvkOMUGqDxCoQKqtI5Zps5vkIit9UM/4G8KhLDnKXMV6YqvXwvctc5SOxOnczlkiKTgReMoOvFOmTxmY7H3B8/Lzx6ldBZIwNt7SYMCwG57xGrrMnBwqfsFWsdYK3RZ93vQ=,iv:gs5npd0vgOVCc6IQ5RM4fUJms+e10YU6E86YfLxgAyU=,tag:UvofNIAAeh80JPnXYedShw==,type:str]\n            tls.key: ENC[AES256_GCM,data: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,iv:+i1NJ11DwWQJifHQT4G8noDAdDw/7Wd4IgLo2AHMy6c=,tag:2vrrKyrY+yKtuLuEJZX1Cg==,type:str]\nsops:\n    kms: []\n    gcp_kms: []\n    azure_kv: []\n    hc_vault: []\n    age:\n        - recipient: age1pqkt694pps8jf408tmn8gg6692mpvh23nw9jvqsfxayy9fjth9msps9fcu\n          enc: |\n            -----BEGIN AGE ENCRYPTED FILE-----\n            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBTRVlOWi9MVXJNR1Azc0Fs\n            RW5FZ2tMa09IY1o3WGNvbVNMVEhMMmxCd1hrCnVLdWJRUU1jQ2VpN2lxVjhZaTI2\n            eDZTV1JLQzZWRmREeFZZQzY3d2xNcGMKLS0tIFlTaUlOYWlERHM3djQ2a2ZOTkVp\n            WDJVaEdJTzZNVkJjMTNHYW5tUC9tSDgK3q6lr/0LjclXr45y3CqD5WDgHTX1yhzy\n            j7wthuY1QKJkmPWYG7elEPORObt4ZNV/6xunppranNjH6rM08ZzgWQ==\n            -----END AGE ENCRYPTED FILE-----\n    lastmodified: \"2026-01-08T08:36:36Z\"\n    mac: ENC[AES256_GCM,data:ZkqWzePPCH0hQSxSg+1PLyFe/ZElXFTG+Fwc7V4pcWTNOTDNgbjzuqRyKlBkpQBb0gJOYAcNxxKrdnbTcIfAwePQ9J1x3Tw2Ew0nV+UWJ3SyuLSxg5SAPC2n8TEIwmfuzufse4C/ugM2Zyb25+QCaQQtHFulJ8NVFHSngx4mhn8=,iv:dg7qHFxS2dVC8s8T2SRZ/4CR2kRsYHZfayYpAcg0Nw4=,tag:xYtLDMuMNqy3cnZcgoINLA==,type:str]\n    pgp: []\n    encrypted_regex: ^(data|stringData)$\n    version: 3.9.4\n"}
{"type":"file","path":"helm/infra/static/issuers/k8s/50-clusterIssuers.yaml","role":"k8s-manifest","criticality":"unknown","bytes":582,"sha1":"6f108b29c35c143e3f4262646c46782d631b6af1","truncated":false,"content":"apiVersion: cert-manager.io/v1\nkind: ClusterIssuer\nmetadata:\n  name: clusterissuer-lan-smarthome\nspec:\n  ca:\n    secretName: smarthome-root-ca\n\n---\napiVersion: cert-manager.io/v1\nkind: ClusterIssuer\nmetadata:\n  name: clusterissuer-cloudflare\nspec:\n  acme:\n    server: https://acme-v02.api.letsencrypt.org/directory\n    email: brandonhowlett.unraid@gmail.com\n    privateKeySecretRef:\n      name: cloudflare-clusterissuer-account-key\n    solvers:\n      - dns01:\n          cloudflare:\n            apiTokenSecretRef:\n              name: cloudflare-api-token\n              key: api-token"}
{"type":"file","path":"helm/infra/static/namespaces/10-sops-operator.yaml","role":"unknown","criticality":"unknown","bytes":96,"sha1":"a0f03094886130a29acddf6d043c7b9752c9bed5","truncated":false,"content":"apiVersion: v1\nkind: Namespace\nmetadata:\n  name: sops-operator\n  labels:\n    app: sops-operator\n"}
{"type":"file","path":"helm/infra/static/namespaces/20-cert-manager.yaml","role":"unknown","criticality":"unknown","bytes":94,"sha1":"56a84e8b978da37589fb00128bed56a561cb1b46","truncated":false,"content":"apiVersion: v1\nkind: Namespace\nmetadata:\n  name: cert-manager\n  labels:\n    app: cert-manager\n"}
{"type":"file","path":"helm/infra/static/namespaces/30-traefik.yaml","role":"unknown","criticality":"unknown","bytes":84,"sha1":"7c060b899189363b1ae389159302139e96af5b16","truncated":false,"content":"apiVersion: v1\nkind: Namespace\nmetadata:\n  name: traefik\n  labels:\n    app: traefik\n"}
{"type":"file","path":"helm/infra/static/namespaces/40-cloudflared.yaml","role":"unknown","criticality":"unknown","bytes":92,"sha1":"93d1003031717749953ce6714d877af7e6ae7691","truncated":false,"content":"apiVersion: v1\nkind: Namespace\nmetadata:\n  name: cloudflared\n  labels:\n    app: cloudflared\n"}
{"type":"file","path":"helm/platform/debug/k8s/busybox.yaml","role":"k8s-manifest","criticality":"unknown","bytes":304,"sha1":"23acc8a38424980de81842b335af78ac2dbe4101","truncated":false,"content":"apiVersion: v1\nkind: Namespace\nmetadata:\n  name: net-tools\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: busybox\n  namespace: net-tools\nspec:\n  containers:\n  - name: busybox\n    image: busybox:1.36\n    command:\n      - sleep\n      - \"3600\"\n    securityContext:\n      runAsUser: 0\n  restartPolicy: Never\n"}
{"type":"file","path":"helm/platform/debug/workload.yaml","role":"unknown","criticality":"unknown","bytes":73,"sha1":"2cfbcac498cc2761e1500c8b0956c62b73ddcbd7","truncated":false,"content":"kind: none\r\nname: busybox\r\nnamespace: default\r\nrollout:\r\n  enabled: false"}
{"type":"file","path":"helm/platform/home-assistant/Chart.yaml","role":"helm-chart","criticality":"unknown","bytes":301,"sha1":"b1a9a37afc6e259c22846c0fd4608854e6809c81","truncated":false,"content":"apiVersion: v2\nname: home-assistant\ndescription: \"Home Assistant deployment for smart home services\"\ntype: application\nversion: 1.0.0\nappVersion: \"2025.12.0\" # replace with actual HA version\nkeywords:\n  - home-assistant\n  - automation\nmaintainers:\n  - name: Brandon\n    email: brandonhowlett@gmail.com"}
{"type":"file","path":"helm/platform/home-assistant/k8s/00-namespace.yaml","role":"k8s-manifest","criticality":"unknown","bytes":122,"sha1":"3660ff564ab0b043bf536341ecd599a9d09b06c1","truncated":false,"content":"apiVersion: v1\nkind: Namespace\nmetadata:\n  name: home-assistant\n  labels:\n    name: home-assistant\n    app: home-assistant"}
{"type":"file","path":"helm/platform/home-assistant/k8s/30-certificates.yaml","role":"k8s-manifest","criticality":"unknown","bytes":756,"sha1":"c86f66787a9df8cfb8d5b249ff5586ee6d6b1244","truncated":false,"content":"apiVersion: cert-manager.io/v1\nkind: Certificate\nmetadata:\n  name: home-assistant-internal\n  namespace: home-assistant\nspec:\n  secretName: home-assistant-internal-tls\n  duration: 2160h\n  renewBefore: 360h\n  issuerRef:\n    name: clusterissuer-lan-smarthome\n    kind: ClusterIssuer\n  commonName: ha.smart.home\n  dnsNames:\n    - ha.smart.home\n    - home-assistant.home-assistant.svc.cluster.local\n\n---\napiVersion: cert-manager.io/v1\nkind: Certificate\nmetadata:\n  name: home-assistant-external\n  namespace: home-assistant\nspec:\n  secretName: home-assistant-external-tls\n  duration: 2160h\n  renewBefore: 360h\n  issuerRef:\n    name: clusterissuer-cloudflare\n    kind: ClusterIssuer\n  commonName: haos.brandonhowlett.com\n  dnsNames:\n    - haos.brandonhowlett.com\n"}
{"type":"file","path":"helm/platform/home-assistant/k8s/40-ingress.yaml","role":"k8s-manifest","criticality":"unknown","bytes":635,"sha1":"dbe21b417a8b8318ce0c955c570cee9317465683","truncated":false,"content":"apiVersion: traefik.io/v1alpha1\nkind: IngressRoute\nmetadata:\n  name: home-assistant-internal\n  namespace: home-assistant\nspec:\n  entryPoints:\n    - websecure\n  routes:\n    - match: Host(`ha.smart.home`)\n      kind: Rule\n      services:\n        - name: home-assistant\n          port: 8123\n  tls:\n    secretName: home-assistant-internal-tls\n\n---\napiVersion: traefik.io/v1alpha1\nkind: IngressRoute\nmetadata:\n  name: home-assistant-external\n  namespace: home-assistant\nspec:\n  entryPoints:\n    - web\n  routes:\n    - match: Host(`haos.brandonhowlett.com`)\n      kind: Rule\n      services:\n        - name: home-assistant\n          port: 8123"}
{"type":"file","path":"helm/platform/home-assistant/values.yaml","role":"helm-values","criticality":"medium","bytes":1128,"sha1":"3b10fd073c5209abbe4fd6b7f3226c8ab7a31609","truncated":false,"content":"image:\n  tag: stable\n\npersistence:\n  enabled: true\n  accessMode: ReadWriteOnce\n  size: 20Gi\n  storageClass: local-path\n\n# Service\nservice:\n  type: ClusterIP\n  port: 8123\n\n# Ingress via Traefik\ningress:\n  enabled: false\n  # Set to true to allow Traefik to route traffic correctly\n  external: true\n  annotations:\n    # kubernetes.io/ingress.class: traefik\n    cert-manager.io/cluster-issuer: clusterissuer-cloudflare\n    # traefik.ingress.kubernetes.io/router.entrypoints: \"websecure\"\n    # traefik.ingress.kubernetes.io/router.tls: \"true\"\n  # hosts:\n  #   - host: ha.smart.home\n  #     paths:\n  #       - /\n  #   - host: haos.brandonhowlett.com\n  #     paths:\n  #       - /\n  # tls:\n  #   - hosts:\n  #       - ha.smart.home\n  #     secretName: ha-smart-home-tls\n  #   - hosts:\n  #       - haos.brandonhowlett.com\n  #     secretName: haos-brandonhowlett-tls\n\n# Optional: Addons or integrations can be defined here\naddons: {}\n\nsecurityContext:\n  runAsUser: 1000\n  runAsGroup: 1000\n\nconfiguration:\n  enabled: true\n  trusted_proxies:\n    - 10.0.0.0/8\n  initContainer:\n    securityContext:\n      runAsUser: 1000\n      runAsGroup: 1000"}
{"type":"file","path":"helm/platform/home-assistant/workload.yaml","role":"unknown","criticality":"unknown","bytes":108,"sha1":"1f84aeb196337292911898641ab3fec985899541","truncated":false,"content":"kind: statefulset\r\nname: home-assistant\r\nnamespace: home-assistant\r\nrollout:\r\n  enabled: true\r\n  timeout: 5m"}
{"type":"file","path":"helm/platform/whoami/k8s/00-namespace.yaml","role":"k8s-manifest","criticality":"unknown","bytes":82,"sha1":"c8527ed9fd5535602d3eac88e16ff2d8b0a0e557","truncated":false,"content":"apiVersion: v1\nkind: Namespace\nmetadata:\n  name: whoami\n  labels:\n    app: whoami\n"}
{"type":"file","path":"helm/platform/whoami/k8s/20-certificates.yaml","role":"k8s-manifest","criticality":"unknown","bytes":704,"sha1":"012688d32a24b8f1e2d78253b365e6422860e78c","truncated":false,"content":"apiVersion: cert-manager.io/v1\nkind: Certificate\nmetadata:\n  name: whoami-internal\n  namespace: whoami\nspec:\n  secretName: whoami-internal-tls\n  duration: 2160h\n  renewBefore: 360h\n  issuerRef:\n    name: clusterissuer-lan-smarthome\n    kind: ClusterIssuer\n  commonName: whoami.smart.home\n  dnsNames:\n    - whomai.smart.home\n    - whoami.whoami.svc.cluster.local\n\n---\napiVersion: cert-manager.io/v1\nkind: Certificate\nmetadata:\n  name: whoami-external\n  namespace: whoami\nspec:\n  secretName: whoami-external-tls\n  duration: 2160h\n  renewBefore: 360h\n  issuerRef:\n    name: clusterissuer-cloudflare\n    kind: ClusterIssuer\n  commonName: whoami.brandonhowlett.com\n  dnsNames:\n    - whoami.brandonhowlett.com\n"}
{"type":"file","path":"helm/platform/whoami/k8s/40-ingress.yaml","role":"k8s-manifest","criticality":"unknown","bytes":677,"sha1":"c59b935bdb2b42135494036d406e383e239ca7fe","truncated":false,"content":"apiVersion: traefik.io/v1alpha1\nkind: IngressRoute\nmetadata:\n  name: whoami-internal\n  namespace: whoami\nspec:\n  entryPoints:\n    - websecure\n  routes:\n    - match: Host(`whoami.smart.home`)\n      kind: Rule\n      services:\n        - name: whoami\n          port: 80\n  tls:\n    secretName: whoami-internal-tls\n    # secretName: smarthome-wildcard-tls\n\n---\napiVersion: traefik.io/v1alpha1\nkind: IngressRoute\nmetadata:\n  name: whoami-external\n  namespace: whoami\nspec:\n  entryPoints:\n    - web\n  routes:\n    - match: Host(`whoami.brandonhowlett.com`)\n      kind: Rule\n      services:\n        - name: whoami\n          port: 80\n  # tls:\n  #   secretName: home-assistant-external-tls"}
{"type":"file","path":"helm/platform/whoami/k8s/deployment.yaml","role":"k8s-manifest","criticality":"unknown","bytes":350,"sha1":"231d8abacbff6e782986d737ad7d1b3f61c1ef24","truncated":false,"content":"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: whoami\n  namespace: whoami\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: whoami\n  template:\n    metadata:\n      labels:\n        app: whoami\n    spec:\n      containers:\n        - name: whoami\n          image: containous/whoami:latest\n          ports:\n            - containerPort: 80"}
{"type":"file","path":"helm/platform/whoami/k8s/service.yaml","role":"k8s-manifest","criticality":"unknown","bytes":172,"sha1":"92a7c0e9d9dc932e41cbf1381c297b93974af8cb","truncated":false,"content":"apiVersion: v1\nkind: Service\nmetadata:\n  name: whoami\n  namespace: whoami\nspec:\n  selector:\n    app: whoami\n  ports:\n    - protocol: TCP\n      port: 80\n      targetPort: 80"}
{"type":"file","path":"helm/platform/whoami/workload.yaml","role":"unknown","criticality":"unknown","bytes":91,"sha1":"25530f898bf3603364e29bc1167a611eb9f674aa","truncated":false,"content":"kind: deployment\r\nname: whoami\r\nnamespace: whoami\r\nrollout:\r\n  enabled: true\r\n  timeout: 2m"}
{"type":"file","path":"lib/apply-layer.sh","role":"bootstrap-library","criticality":"unknown","bytes":685,"sha1":"4d3d22bc630b876e8e861413d43cac12b6f69bf9","truncated":false,"content":"#!/usr/bin/env bash\nset -euo pipefail\n\napply_layer() {\n  local DIR=\"$1\"\n\n  log_debug \"apply_layer invoked with DIR=${DIR}\"\n\n  if [[ ! -d \"$DIR\" ]]; then\n    log_error \"Directory not found: $DIR\"\n    return 1\n  fi\n\n  log_info \"Applying Kubernetes manifests from layer: $DIR\"\n\n  mapfile -t FILES < <(find \"$DIR\" -type f -name '*.yaml' | sort)\n\n  log_debug \"Found ${#FILES[@]} manifest(s)\"\n\n  for f in \"${FILES[@]}\"; do\n    if [[ \"$f\" =~ \\.sops\\.yaml$ ]]; then\n      log_info \"Applying encrypted manifest: $f\"\n      sops -d \"$f\" | kubectl apply -f -\n    else\n      log_info \"Applying manifest: $f\"\n      kubectl apply -f \"$f\"\n    fi\n  done\n\n  log_debug \"Completed apply_layer for $DIR\"\n}\n"}
{"type":"file","path":"lib/helm-helpers.sh","role":"bootstrap-library","criticality":"unknown","bytes":2913,"sha1":"76002b66bba77f35c0cabed889c74df34e4c9723","truncated":false,"content":"#!/usr/bin/env bash\nset -euo pipefail\n\n# -------------------------------------------------------------------\n# Helm Repositories\n# -------------------------------------------------------------------\nhelm_add_repos() {\n  local -n repos=$1\n  local repo url\n\n  log_info \"Registering Helm repositories\"\n\n  for repo in \"${!repos[@]}\"; do\n    url=\"${repos[$repo]}\"\n    log_debug \"Adding/updating Helm repo: $repo â†’ $url\"\n\n    if helm repo list -o yaml | grep -qE \"^name: $repo$\"; then\n      log_debug \"Helm repo '$repo' already exists; updating\"\n      helm repo add \"$repo\" \"$url\" --force-update >/dev/null\n    else\n      helm repo add \"$repo\" \"$url\" >/dev/null\n    fi\n  done\n\n  log_debug \"Updating Helm repo index\"\n  helm repo update >/dev/null\n}\n\n# -------------------------------------------------------------------\n# Helm Argument Construction\n# -------------------------------------------------------------------\n\n_helm_base_args() {\n  local name=\"$1\"\n  local chart=\"$2\"\n  local namespace=\"$3\"\n  local version=\"$4\"\n  local values=\"${5:-}\"\n\n  version=\"v${version#v}\"\n\n  local args=(\n    \"$name\" \"$chart\"\n    --namespace \"$namespace\"\n    --version \"$version\"\n  )\n\n  [[ -n \"$values\" && -f \"$values\" ]] && {\n    args+=(--values \"$values\")\n  }\n\n  echo \"${args[@]}\"\n}\n\n# -------------------------------------------------------------------\n# Helm Release Management\n# -------------------------------------------------------------------\n\nhelm_install_or_upgrade() {\n  local name=\"$1\"\n  local chart=\"$2\"\n  local namespace=\"$3\"\n  local version=\"$4\"\n  local values=\"${5:-}\"\n  shift 5\n  local extra_args=(\"$@\")\n\n  if [[ -z \"$namespace\" ]]; then\n    log_warn \"Namespace empty; defaulting to release name: $name\"\n    namespace=\"$name\"\n  fi\n\n  log_info \"Installing/upgrading Helm release '$name' in namespace '$namespace'\"\n\n  kubectl create namespace \"$namespace\" \\\n    --dry-run=client -o yaml | kubectl apply -f - >/dev/null\n\n  local args\n  args=($(_helm_base_args \"$name\" \"$chart\" \"$namespace\" \"$version\" \"$values\"))\n\n  log_debug \"Helm args: ${args[*]} ${extra_args[*]}\"\n\n  log_debug \"Constructing Helm args: name=$name chart=$chart namespace=$namespace version=$version\"\n\n\n  helm upgrade --install \"${args[@]}\" \\\n    --wait \\\n    --timeout 5m \\\n    ${HELM_ATOMIC:+--atomic} \\\n    \"${extra_args[@]}\"\n}\n\n# -------------------------------------------------------------------\n# Helm Template Rendering\n# -------------------------------------------------------------------\n\nhelm_template() {\n  local args\n  args=($(_helm_base_args \"$@\"))\n\n  log_debug \"Rendering Helm template: ${args[*]}\"\n  helm template \"${args[@]}\"\n}\n\n# -------------------------------------------------------------------\n# Helm Template + Apply\n# -------------------------------------------------------------------\n\nhelm_template_apply() {\n  log_info \"Applying Helm-rendered manifests (server-side)\"\n  helm_template \"$@\" | kubectl apply --server-side -f -\n}\n"}
{"type":"file","path":"lib/helpers.sh","role":"bootstrap-library","criticality":"unknown","bytes":8336,"sha1":"20d34643e0f1fbab5917db8b25725ea3557fe674","truncated":false,"content":"#!/usr/bin/env bash\nset -euo pipefail\n\ncompare_versions() {\n  # returns 0 if $1 >= $2, else 1\n  # naive numeric compare, suitable for major.minor.patch\n  local ver1=\"$1\"\n  local ver2=\"$2\"\n\n  IFS=. read -r -a v1 <<< \"${ver1//[!0-9.]/}\"\n  IFS=. read -r -a v2 <<< \"${ver2//[!0-9.]/}\"\n\n  for i in 0 1 2; do\n    local n1=\"${v1[i]:-0}\"\n    local n2=\"${v2[i]:-0}\"\n    (( n1 > n2 )) && return 0\n    (( n1 < n2 )) && return 1\n  done\n  return 0\n}\n\nparse_duration_seconds() {\n  local input=\"$1\"\n\n  [[ -n \"$input\" ]] || {\n    log_error \"Empty duration provided\"\n    return 1\n  }\n\n  if [[ \"$input\" =~ ^[0-9]+$ ]]; then\n    echo \"$input\"\n    return 0\n  fi\n\n  if [[ \"$input\" =~ ^([0-9]+)([smh])$ ]]; then\n    local value=\"${BASH_REMATCH[1]}\"\n    local unit=\"${BASH_REMATCH[2]}\"\n\n    case \"$unit\" in\n      s) echo \"$value\" ;;\n      m) echo $((value * 60)) ;;\n      h) echo $((value * 3600)) ;;\n    esac\n    return 0\n  fi\n\n  log_error \"Invalid duration format: '$input' (expected: Ns | Nm | Nh | N)\"\n  return 1\n}\n\nis_label_selector() {\n  # Matches: key=value[,key=value...]\n  [[ \"$1\" =~ ^[a-zA-Z0-9_.-]+=[^=,]+(,[a-zA-Z0-9_.-]+=[^=,]+)*$ ]]\n}\n\nretry() {\n  local n=${RETRY_ATTEMPTS:-5}\n  local delay=${RETRY_DELAY:-5}\n  local i=1\n\n  log_debug \"Retry wrapper invoked: attempts=$n delay=${delay}s command=$*\"\n\n  until \"$@\"; do\n    if (( i >= n )); then\n      log_error \"Command failed after $n attempts: $*\"\n      return 1\n    fi\n\n    log_warn \"Retry $i/$n failed; retrying in ${delay}s: $*\"\n    ((i++))\n    sleep \"$delay\"\n  done\n\n  log_debug \"Command succeeded after $i attempt(s)\"\n}\n\ncheck_required_env_vars() {\n  local missing=0 var\n  [[ $# -gt 0 ]] || { log_error \"No environment variables specified\"; exit 1; }\n\n  for var in \"$@\"; do\n    if [[ -n \"${!var:-}\" ]]; then\n      printf -v \"$var\" '%s' \"${!var}\"\n    fi\n  done\n\n  for var in \"$@\"; do\n    if [[ -z \"${!var:-}\" ]]; then\n      log_error \"Required environment variable not set: $var\"\n      ((missing++))\n    else\n      log_debug \"Env OK: $var=${!var}\"\n    fi\n  done\n\n  (( missing == 0 )) || exit 1\n}\n\ncheck_required_cmds() {\n  local missing=0 cmd\n  [[ $# -gt 0 ]] || { log_error \"No commands specified\"; exit 1; }\n\n  for cmd in \"$@\"; do\n    if ! command -v \"$cmd\" >/dev/null 2>&1; then\n      log_warn \"Command missing: $cmd\"\n      ((missing++))\n    else\n      log_debug \"Command available: $cmd\"\n    fi\n  done\n\n  (( missing == 0 )) || {\n    log_info \"Some commands are missing and may need to be installed\"\n    exit 1\n  }\n}\n\n### Kubectl Helpers ### MOVE LATER\n\nvalidate_workload_kind() {\n  case \"$WORKLOAD_KIND\" in\n    deployment|statefulset|daemonset|none) ;;\n    *)\n      log_error \"Invalid workload kind '${WORKLOAD_KIND}'\"\n      return 1\n      ;;\n  esac\n}\n\nload_workload_metadata() {\n  local dir=\"$1\"\n  local file=\"${dir}/workload.yaml\"\n\n  [[ -f \"$file\" ]] || return 1\n\n  WORKLOAD_KIND=\"$(yq -r '.kind' \"$file\")\"\n  WORKLOAD_NAME=\"$(yq -r '.name // \"\"' \"$file\")\"\n  WORKLOAD_NAMESPACE=\"$(yq -r '.namespace // \"default\"' \"$file\")\"\n  WORKLOAD_TIMEOUT=\"$(yq -r '.rollout.timeout // \"120s\"' \"$file\")\"\n  WORKLOAD_ROLLOUT_ENABLED=\"$(yq -r '.rollout.enabled // true' \"$file\")\"\n}\n\nwait_for_workload_exist() {\n  local kind=\"$1\"     # deployment | statefulset | daemonset\n  local name=\"$2\"\n  local namespace=\"$3\"\n  local timeout=\"$4\"\n\n  local timeout_s\n  timeout_s=\"$(parse_duration_seconds \"$timeout\")\"\n\n  local start=$SECONDS\n  local poll=3\n\n  log_info \"Waiting for ${kind} '${name}' in namespace '${namespace}' (timeout=${timeout_s}s)\"\n\n  until kubectl get \"$kind\" \"$name\" -n \"$namespace\" >/dev/null 2>&1; do\n    (( SECONDS - start >= timeout_s )) && {\n      log_error \"Timed out waiting for ${kind} '${name}'\"\n      return 1\n    }\n    sleep \"$poll\"\n  done\n\n  log_debug \"${kind} '${name}' exists\"\n}\n\nwait_for_workload() {\n  [[ \"$WORKLOAD_ROLLOUT_ENABLED\" != \"true\" ]] && return 0\n\n  wait_for_workload_exist \\\n    \"$WORKLOAD_KIND\" \\\n    \"$WORKLOAD_NAME\" \\\n    \"$WORKLOAD_NAMESPACE\" \\\n    \"$WORKLOAD_TIMEOUT\"\n\n  case \"$WORKLOAD_KIND\" in\n    deployment|daemonset|statefulset)\n      wait_for_rollout \\\n        \"${WORKLOAD_KIND}/${WORKLOAD_NAME}\" \\\n        \"$WORKLOAD_NAMESPACE\" \\\n        \"$WORKLOAD_TIMEOUT\"\n      ;;\n    none) ;;\n    *)\n      log_error \"Unsupported workload kind: $WORKLOAD_KIND\"\n      return 1\n      ;;\n  esac\n}\n\nwait_for_deployment_by_name() {\n  local name=\"$1\"\n  local namespace=\"${2:-default}\"\n  local timeout_input=\"${3:-120}\"\n\n  [[ -z \"$name\" ]] && {\n    log_error \"wait_for_deployment_by_name: deployment name is required\"\n    return 2\n  }\n\n  local timeout_s\n  timeout_s=\"$(parse_duration_seconds \"$timeout_input\")\"\n\n  local start=$SECONDS\n  local elapsed=0\n  local poll_interval=3\n\n  log_info \"Waiting for Deployment '${name}' in namespace '${namespace}' (timeout=${timeout_s}s)\"\n\n  until kubectl get deployment \"${name}\" -n \"${namespace}\" >/dev/null 2>&1; do\n    sleep \"$poll_interval\"\n    elapsed=$((SECONDS - start))\n\n    if (( elapsed >= timeout_s )); then\n      log_error \"Timed out waiting for Deployment '${name}' in namespace '${namespace}'\"\n      return 1\n    fi\n\n    log_debug \"Deployment '${name}' not present yet (${elapsed}/${timeout_s}s)\"\n  done\n\n  log_debug \"Deployment '${name}' exists (API object present)\"\n}\n\nwait_for_deployment_by_label() {\n  local selector=\"$1\"\n  local namespace=\"${2:-default}\"\n  local timeout_input=\"${3:-120}\"\n\n  [[ -z \"$selector\" ]] && {\n    log_error \"wait_for_deployment_by_label: label selector is required\"\n    return 2\n  }\n\n  is_label_selector \"$selector\" || {\n    log_error \"Invalid label selector '${selector}'\"\n    return 2\n  }\n\n  local timeout_s\n  timeout_s=\"$(parse_duration_seconds \"$timeout_input\")\"\n\n  local start=$SECONDS\n  local poll_interval=3\n\n  log_info \"Waiting for Deployment with selector '${selector}' in namespace '${namespace}' (timeout=${timeout_s}s)\"\n\n  until kubectl get deployment \\\n      -n \"${namespace}\" \\\n      -l \"${selector}\" \\\n      -o jsonpath='{.items[0].metadata.name}' 2>/dev/null | grep -q .; do\n\n    (( SECONDS - start >= timeout_s )) && {\n      log_error \"Timed out waiting for Deployment with selector '${selector}' in namespace '${namespace}'\"\n      return 1\n    }\n\n    sleep \"$poll_interval\"\n  done\n\n  local count\n  count=$(kubectl get deployment -n \"${namespace}\" -l \"${selector}\" --no-headers 2>/dev/null | wc -l)\n\n  (( count > 1 )) && \\\n    log_debug \"Selector '${selector}' matched ${count} Deployments\"\n\n  log_debug \"Deployment detected for selector '${selector}'\"\n}\n\nwait_for_deployment() {\n  local target=\"$1\"\n  local namespace=\"${2:-default}\"\n  local timeout=\"${3:-120}\"\n\n  [[ -z \"$target\" ]] && {\n    log_error \"wait_for_deployment: target is required\"\n    return 2\n  }\n\n  if is_label_selector \"$target\"; then\n    wait_for_deployment_by_label \"$target\" \"$namespace\" \"$timeout\" || return $?\n  else\n    wait_for_deployment_by_name \"$target\" \"$namespace\" \"$timeout\" || return $?\n  fi\n}\n\nwait_for_rollout() {\n  local resource=\"$1\"\n  local namespace=\"${2:-default}\"\n  local timeout_input=\"${3:-120}\"\n\n  local kind name\n  if [[ \"$resource\" == */* ]]; then\n    kind=\"${resource%%/*}\"\n    name=\"${resource##*/}\"\n  else\n    kind=\"deployment\"\n    name=\"$resource\"\n  fi\n\n  case \"$kind\" in\n    deployment|daemonset|statefulset) ;;\n    *)\n      log_error \"Unsupported rollout kind '${kind}' (resource='${resource}')\"\n      return 1\n      ;;\n  esac\n\n  local timeout_s\n  timeout_s=\"$(parse_duration_seconds \"$timeout_input\")\"\n\n  log_info \"Waiting for rollout of ${kind}/${name} in namespace '${namespace}' (timeout=${timeout_s}s)\"\n\n  if ! kubectl rollout status \\\n      \"${kind}/${name}\" \\\n      -n \"${namespace}\" \\\n      --timeout=\"${timeout_s}s\"; then\n    log_error \"Rollout failed for ${kind}/${name} in namespace '${namespace}'\"\n    return 1\n  fi\n\n  log_info \"Rollout complete: ${kind}/${name}\"\n}\n\nwait_for_deployment_rollout() {\n  local resource=\"$1\"\n  local namespace=\"${2:-default}\"\n  local exist_timeout_input=\"${3:-120}\"\n  local rollout_timeout_input=\"${4:-$exist_timeout_input}\"\n\n  local name\n  if [[ \"$resource\" == */* ]]; then\n    name=\"${resource##*/}\"\n  else\n    name=\"$resource\"\n  fi\n\n  log_info \"Ensuring Deployment '${name}' is present and rolled out\"\n\n  wait_for_deployment \\\n    \"${name}\" \\\n    \"${namespace}\" \\\n    \"${exist_timeout_input}\"\n\n  wait_for_rollout \\\n    \"${resource}\" \\\n    \"${namespace}\" \\\n    \"${rollout_timeout_input}\"\n\n  log_info \"Deployment '${name}' is ready\"\n}\n"}
{"type":"file","path":"lib/loader.sh","role":"bootstrap-library","criticality":"unknown","bytes":2585,"sha1":"60d1efde5190f89414bfaf22c029e7e24d16ea65","truncated":false,"content":"#!/usr/bin/env bash\nset -euo pipefail\n\n# -------------------------------------------------------------------\n# Logging (must be first)\n# -------------------------------------------------------------------\n\nreadonly LOG_LEVEL_DEBUG=10\nreadonly LOG_LEVEL_INFO=20\nreadonly LOG_LEVEL_WARN=30\nreadonly LOG_LEVEL_ERROR=40\n\n: \"${LOG_LEVEL:=${LOG_LEVEL_INFO}}\"\n\n_log_ts() {\n  date +\"%Y-%m-%dT%H:%M:%S%z\"\n}\n\n_log_emit() {\n  local level=\"$1\"\n  local label=\"$2\"\n  shift 2\n\n  (( LOG_LEVEL <= level )) || return 0\n\n  printf '[%s] %-5s %s\\n' \\\n    \"$(_log_ts)\" \\\n    \"$label\" \\\n    \"$*\" >&2\n}\n\n# Left for testing purposes only >>> REMOVE LATER <<<\nlog() { \n  printf '[%s] %s\\n' \\\n    \"$(_log_ts)\" \\\n    \"$*\" >&2\n}\n\nlog_debug() { _log_emit \"${LOG_LEVEL_DEBUG}\" \"DEBUG\" \"$@\"; }\nlog_info()  { _log_emit \"${LOG_LEVEL_INFO}\"  \"INFO \" \"$@\"; }\nlog_warn()  { _log_emit \"${LOG_LEVEL_WARN}\"  \"WARN \" \"$@\"; }\nlog_error() { _log_emit \"${LOG_LEVEL_ERROR}\" \"ERROR\" \"$@\"; }\n\ndie() {\n  log_error \"$@\"\n  exit 1\n}\n\n# -------------------------------------------------------------------\n# Prevent double-load\n# -------------------------------------------------------------------\n[[ -n \"${__BOOTSTRAP_LIB_LOADED:-}\" ]] && return\n__BOOTSTRAP_LIB_LOADED=1\n\n# -------------------------------------------------------------------\n# Base script dir\n# -------------------------------------------------------------------\nSCRIPT_DIR=\"$(cd \"$(dirname \"${BASH_SOURCE[0]}\")\" && pwd)\"\n\n# -------------------------------------------------------------------\n# Load paths\n# -------------------------------------------------------------------\nif [[ -z \"${__PATHS_LOADED:-}\" ]]; then\n    source \"$SCRIPT_DIR/paths.sh\"\n    __PATHS_LOADED=1\nfi\n\n# -------------------------------------------------------------------\n# Load bootstrap.env\n# -------------------------------------------------------------------\nif [[ -z \"${__VERSIONS_ENV_LOADED:-}\" ]]; then\n    source \"${BOOTSTRAP_ENV}\"\n    __VERSIONS_ENV_LOADED=1\nfi\n\n# -------------------------------------------------------------------\n# Source all library scripts in lib/\n# -------------------------------------------------------------------\nshopt -s nullglob\nfor libfile in \"$LIB_DIR\"/*.sh; do\n    [[ \"$(basename \"$libfile\")\" == \"loader.sh\" ]] && continue\n    [[ \"$(basename \"$libfile\")\" == \"paths.sh\" ]] && continue\n\n    safe_name=\"${libfile##*/}\"\n    safe_name=\"${safe_name%.sh}\"\n    safe_name=\"${safe_name//-/_}\"\n    guard_var=\"__LIB_${safe_name}_LOADED\"\n\n    if [[ -z \"${!guard_var:-}\" ]]; then\n        source \"$libfile\"\n        declare -g \"$guard_var\"=1\n    fi\ndone\nshopt -u nullglob\n"}
{"type":"file","path":"lib/operator-helpers.sh","role":"bootstrap-library","criticality":"unknown","bytes":2766,"sha1":"a2c9c76ec35704413898ff1035ec1032b3bd0c29","truncated":false,"content":"#!/usr/bin/env bash\nset -euo pipefail\n\napply_operator_manifests() {\n  local op=\"$1\"\n  local subpath=\"${2:-}\"\n\n  log_debug \"apply_operator_manifests op=$op subpath=$subpath\"\n\n  if [[ \"$subpath\" == *\"..\"* ]]; then\n    log_error \"Unsafe subpath rejected: $subpath\"\n    return 1\n  fi\n\n  [[ -n \"$subpath\" && \"$subpath\" != /* ]] && subpath=\"/$subpath\"\n\n  local base=\"${OPERATORS_DIR}/${op}/k8s${subpath}\"\n\n  [[ -d \"$base\" ]] || {\n    log_debug \"No manifests found at $base; skipping\"\n    return 0\n  }\n\n  log_info \"Applying operator manifests for $op from $base\"\n\n  shopt -s nullglob globstar\n\n  for f in \"$base\"/**/*.yaml \"$base\"/**/*.yml; do\n    [[ \"$f\" == *.sops.yaml || \"$f\" == *secret.yaml ]] && continue\n    log_info \"Applying manifest: $f\"\n    kubectl apply --server-side -f \"$f\"\n  done\n\n  for enc in \"$base\"/**/*.sops.yaml; do\n    log_info \"Applying encrypted manifest: $enc\"\n    kubectl apply --server-side -f \"$enc\"\n  done\n\n  shopt -u nullglob globstar\n}\n\nwait_for_secret() {\n  local secret=\"$1\"\n  local namespace=\"${2:-default}\"\n  local timeout=\"${3:-120}\"\n\n  log_info \"Waiting for Secret '$secret' in namespace '$namespace' (timeout=${timeout}s)\"\n\n  for ((i=1; i<=timeout; i++)); do\n    kubectl get secret \"$secret\" -n \"$namespace\" >/dev/null 2>&1 && {\n      log_debug \"Secret available: $secret\"\n      return 0\n    }\n    sleep 1\n  done\n\n  log_error \"Timeout waiting for Secret '$secret' in namespace '$namespace'\"\n  return 1\n}\n\nwait_for_pvc() {\n  local pvc=\"$1\"\n  local namespace=\"${2:-default}\"\n  local timeout=\"${3:-120}\"\n\n  log_info \"Waiting for PVC '$pvc' in namespace '$namespace' (timeout=${timeout}s)\"\n\n  for ((i=1; i<=timeout; i++)); do\n    kubectl get pvc \"$pvc\" -n \"$namespace\" >/dev/null 2>&1 && {\n      log_debug \"PVC bound: $pvc\"\n      return 0\n    }\n    sleep 1\n  done\n\n  log_error \"Timeout waiting for PVC '$pvc' in namespace '$namespace'\"\n  return 1\n}\n\nwait_for_configmap() {\n  local cm=\"$1\"\n  local namespace=\"${2:-default}\"\n  local timeout=\"${3:-120}\"\n\n  log_info \"Waiting for ConfigMap '$cm' in namespace '$namespace' (timeout=${timeout}s)\"\n\n  for ((i=1; i<=timeout; i++)); do\n    kubectl get configmap \"$cm\" -n \"$namespace\" >/dev/null 2>&1 && {\n      log_debug \"ConfigMap available: $cm\"\n      return 0\n    }\n    sleep 1\n  done\n\n  log_error \"Timeout waiting for ConfigMap '$cm' in namespace '$namespace'\"\n  return 1\n}\n\n# wait_for_helm_deployment() {\n#   local release=\"$1\"\n#   local namespace=\"${2:-default}\"\n#   local timeout=\"${3:-120}\"\n\n#   [[ \"$timeout\" =~ [ms]$ ]] || timeout=\"${timeout}s\"\n\n#   log_info \"Waiting for Helm deployment '$release' in namespace '$namespace' (timeout=$timeout)\"\n\n#   kubectl rollout status deployment \\\n#     -l app.kubernetes.io/instance=\"$release\" \\\n#     -n \"$namespace\" \\\n#     --timeout=\"$timeout\"\n# }\n"}
{"type":"file","path":"lib/paths.sh","role":"bootstrap-library","criticality":"unknown","bytes":633,"sha1":"7a64c51a28440866bff56dfc2e74e60830955f40","truncated":false,"content":"#!/usr/bin/env bash\nset -euo pipefail\n\n# ./..\nreadonly AGE_DIR=\"${HOME}/.config/sops/age\"\nreadonly KUBECONFIG_FILE=\"${HOME}/.kube/config\"\n\n# ./\nreadonly ROOT_DIR=\"$(cd \"$(dirname \"${BASH_SOURCE[0]}\")/..\" && pwd)\"\nreadonly BOOTSTRAP_ENV=\"${ROOT_DIR}/bootstrap.env\"\n\n## ./lib/\nreadonly LIB_DIR=\"${ROOT_DIR}/lib\"\n\n## ./scripts/\nreadonly SCRIPTS_DIR=\"${ROOT_DIR}/scripts\"\n\n## ./bootstrap/\nreadonly BOOTSTRAP_DIR=\"${ROOT_DIR}/bootstrap\"\n\n### ./helm/infra/\nreadonly OPERATORS_DIR=\"${ROOT_DIR}/helm/infra/operators\"\nreadonly STATIC_DIR=\"${ROOT_DIR}/helm/infra/static\"\n\n### ./helm/platform/\nreadonly PLATFORM_DIR=\"${ROOT_DIR}/helm/platform\"\n"}
{"type":"file","path":"lib/yq-helpers.sh","role":"bootstrap-library","criticality":"unknown","bytes":2244,"sha1":"f6611d84adfb5c2d8b3f530bdde10ec6b5e7d5a1","truncated":false,"content":"#!/usr/bin/env bash\nset -euo pipefail\n\nget_installed_yq_info() {\n  # Returns: \"source:version\", where source=apt|binary|none\n  if dpkg -s yq >/dev/null 2>&1; then\n    local ver\n    ver=\"$(yq --version 2>/dev/null | head -n1 || echo \"unknown\")\"\n    echo \"apt:${ver}\"\n  elif [[ -x \"/usr/local/bin/yq\" ]]; then\n    local ver\n    ver=\"$(/usr/local/bin/yq --version 2>/dev/null | head -n1 || echo \"unknown\")\"\n    echo \"binary:${ver}\"\n  else\n    echo \"none:0\"\n  fi\n}\n\ninstall_yq() {\n  local info source ver latest_ver\n\n  info=\"$(get_installed_yq_info)\"\n  source=\"${info%%:*}\"\n  ver=\"${info##*:}\"\n\n  # Fetch the latest release version from GitHub\n  latest_ver=\"$(curl -sSL https://api.github.com/repos/mikefarah/yq/releases/latest \\\n                 | yq -r '.tag_name' 2>/dev/null | sed 's/^v//')\"\n\n  case \"$source\" in\n    apt)\n      log_warn \"yq installed via apt (${ver})\"\n      read -rp \"Do you want to uninstall apt yq and use the official binary? [y/N] \" yn\n      if [[ \"$yn\" =~ ^[Yy]$ ]]; then\n        sudo apt-get remove -y yq\n        log_info \"apt yq removed\"\n        install_yq_binary \"$latest_ver\"\n      else\n        log_info \"Keeping apt yq (${ver})\"\n      fi\n      ;;\n    binary)\n      log_info \"yq binary detected: ${ver}\"\n      if [[ -n \"$latest_ver\" && \"$ver\" != \"$latest_ver\" ]]; then\n        log_warn \"yq binary is outdated (installed: ${ver}, latest: ${latest_ver}), updating...\"\n        install_yq_binary \"$latest_ver\"\n      else\n        log_debug \"yq binary is up-to-date (${ver})\"\n      fi\n      ;;\n    none)\n      log_info \"yq not found, installing binary\"\n      install_yq_binary \"$latest_ver\"\n      ;;\n    *)\n      log_error \"Unknown yq installation state: $source\"\n      ;;\n  esac\n}\n\ninstall_yq_binary() {\n  local version=\"${1:-latest}\"\n  local url=\"/usr/local/bin/yq\"\n  local download_url\n\n  if [[ \"$version\" == \"latest\" ]]; then\n    download_url=\"https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64\"\n  else\n    download_url=\"https://github.com/mikefarah/yq/releases/download/v${version}/yq_linux_amd64\"\n  fi\n\n  log_info \"Installing yq binary from ${download_url}\"\n  sudo wget -q \"${download_url}\" -O \"$url\"\n  sudo chmod +x \"$url\"\n  log_info \"yq installed to ${url}: $($url --version 2>&1 | head -n1)\"\n}\n"}
{"type":"file","path":"pki/smarthome-root-ca.crt","role":"pki-artifact","criticality":"unknown","bytes":1919,"sha1":"428b25bdc2fe8b206b3d204f4a2a09d6590385bb","truncated":false,"content":"-----BEGIN CERTIFICATE-----\nMIIFWzCCA0OgAwIBAgIUXoebp8MKiCAuKnjg0bVP1HB8Kc0wDQYJKoZIhvcNAQEL\nBQAwPTELMAkGA1UEBhMCVVMxEjAQBgNVBAoMCVNtYXJ0aG9tZTEaMBgGA1UEAwwR\nU21hcnRob21lIFJvb3QgQ0EwHhcNMjUxMjIzMDYwMTI1WhcNMzUxMjIxMDYwMTI1\nWjA9MQswCQYDVQQGEwJVUzESMBAGA1UECgwJU21hcnRob21lMRowGAYDVQQDDBFT\nbWFydGhvbWUgUm9vdCBDQTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIB\nAKvYraE6RcNMMn7g8bwR+yVoZsu7Wl83umDNn8dMZLaoA8s5WEHDiZXU1EnUybd9\nAOjY6WV0yjcFlLKcU5UclBuuJ/0AU2iq5gBJvnOPHCGSPl7odReRgJIkDrTUJk6F\narYjLvMsWXIGQZ6ql0R3EwViFr8uTXdffYguCrrgddPVBkqEYqAV7tDDd3VWGgeg\ntB28qcDELlqMRk1S0V7WSz19wLVWl+tC/IA4G1v967oW7M0AUAJzygkdb9Xi8EMV\noQ054qJ8nEK/hXYKnNn9NEGShqTmCrD1wYOLUy7mQvN9BdEBnYcWHkB7Pzcgw279\nQhTsbS6k5lh5bEDwzQbhiSEs2ZpxIWpNfo+2TrpwetCakFClas3v3aCMZNehhRh5\nftondK8hZC38aZFfiG528cHk4yQdtB1OjC8iJxW+bScjsMeSxeEEb0mnrniHJQZO\nJbjEx0Xbr0AsGaS6yCXeo7HRGlvt3/W2hdCitRVyrkFdCxQimNAgBrPD9dimWfZ0\ndGY/f9MbzwnngOMw0gppfBJLWof5xuXDA6NLip6pAlffdKdmjV8fp4yh5xDs6oa+\nQxNoXBFWoq/2HsXdwUaM9XSqrUPO1NHv5vOeQPAWqeneavtROxGWaVvIompqC79S\nj/MWSk34sJwFRKTPkCVCmsQvxfgZv1RCP+UI1+VgVKSpAgMBAAGjUzBRMB0GA1Ud\nDgQWBBR/4nuwugFYTf9moyTyIM3dZGcf4TAfBgNVHSMEGDAWgBR/4nuwugFYTf9m\noyTyIM3dZGcf4TAPBgNVHRMBAf8EBTADAQH/MA0GCSqGSIb3DQEBCwUAA4ICAQAQ\nbZUsVpXE/37hhj4BrhUVpeFsbEhvTf/J+sKCOnOtFwH0KpoGQ0rBfvYveaz6xnKk\n3h3u3AL7BzSRAvS+Qk+DdCy1zHw91A/K1hLMZIJffCRsCvgGbM2YEIkLNg9SLrvx\nCiWcpZ0ql5Fu300/NJkoufxbx1fceNKf0rwfyucICj4JUs8wQZMuFeicwNI0ynz1\ndvJhkbiVBxy93wsPEo6WMHmx4GNYQknfGSL3vepIrAYJwpC+XwsaaKyhMis8qj1c\nhOYwTNkg/bO3ml118D9G8ScCp5UedcEWo2OW2XcA/viummtQhpfeXwMy47HkbcMb\nk6wUHmER8zGVkdzgno2TCvpk9pVWjPye5+3VePfJCeE32301XaSxOh3uurAQX6su\nZlC9/z+DniPDBeESusrWU9VLZQK7DGq4p/nrcVMuPXDiGVovOULZN/4NfBllywaa\nnZww7Dd++xGo6sjvODWeA1K8hwOwlDVretYoVLC2AhREP84Jrc0uwvOgXmjfuPtX\ns6jh+3lmjUdRVm5uxvRF96i9ofDTcuuDTfKRWy/c3okqQYoJ3kE5ncng73IPjUy5\nhXQzRurcv3E1kYeK8lKVlj+DpyvCxR17GoZG9yncFssv8mM25ykIKlq5dpNm9p9H\nOUOktBeJ1AzoeDYLc2VcF9Ql4/gVZcoVMdHUUkXqTw==\n-----END CERTIFICATE-----\n"}
{"type":"file","path":"scripts/check-versions.sh","role":"utility-script","criticality":"low","bytes":6184,"sha1":"c5ac1b84161283e84e015d804efc721969e998b1","truncated":false,"content":"#!/usr/bin/env bash\nset -euo pipefail\n\nROOT_DIR=\"$(cd \"$(dirname \"${BASH_SOURCE[0]}\")/..\" && pwd)\"\nsource \"${ROOT_DIR}/lib/loader.sh\"\n\n# =============================================================================\n# CONFIG\n# =============================================================================\n\nreadonly BACKUP_RETENTION=3\n\nlog_debug \"ROOT_DIR=${ROOT_DIR}\"\n\n# =============================================================================\n# HELPERS\n# =============================================================================\n\nprune_old_backups() {\n    local base=\"$1\"\n    local keep=\"$2\"\n    local backups=()\n\n    log_debug \"Pruning backups for base=${base}, keep=${keep}\"\n\n    mapfile -t backups < <(ls -1t \"${base}.bak.\"* 2>/dev/null || true)\n\n    if (( ${#backups[@]} <= keep )); then\n        log_debug \"No old backups to prune (count=${#backups[@]})\"\n        return 0\n    fi\n\n    for old in \"${backups[@]:keep}\"; do\n        rm -f -- \"$old\"\n        log_info \"Pruned old backup: $(basename \"$old\")\"\n    done\n}\n\nsanitize() {\n    tr -d '\\n' <<<\"$1\" | xargs\n}\n\nupdate_env_var() {\n    local key=\"$1\"\n    local value\n    value=\"$(sanitize \"$2\")\"\n\n    log_debug \"Updating ${key}=${value}\"\n\n    if grep -q \"^${key}=\" \"$BOOTSTRAP_ENV\"; then\n        log_debug \"Key ${key} exists; updating in-place\"\n        awk -v k=\"$key\" -v v=\"$value\" '\n            BEGIN { FS=OFS=\"=\" }\n            $1 == k { $2=\"'\"'\"'\" v \"'\"'\"'\" }\n            { print }\n        ' \"$BOOTSTRAP_ENV\" > \"${BOOTSTRAP_ENV}.tmp\"\n        mv \"${BOOTSTRAP_ENV}.tmp\" \"$BOOTSTRAP_ENV\"\n    else\n        log_debug \"Key ${key} does not exist; appending\"\n        echo \"${key}='${value}'\" >> \"$BOOTSTRAP_ENV\"\n    fi\n}\n\nget_latest_github_release() {\n    local repo=\"$1\"\n    log_debug \"Querying GitHub latest release for ${repo}\"\n\n    curl -fsSL \"https://api.github.com/repos/$repo/releases/latest\" \\\n        | jq -r '.tag_name // empty'\n}\n\nget_helm_deployed_chart_version() {\n    local release=\"$1\"\n    log_debug \"Resolving deployed Helm chart version for release=${release}\"\n\n    helm list -A -o json \\\n        | jq -r \".[] | select(.name==\\\"$release\\\") | .chart\" \\\n        | awk -F'-' '{print $NF}' \\\n        | sed 's/^v//' \\\n        || echo \"unknown\"\n}\n\nget_helm_latest_chart_version() {\n    local chart_ref=\"$1\"\n    log_debug \"Resolving latest Helm chart version for ${chart_ref}\"\n\n    helm search repo \"$chart_ref\" --versions -o json \\\n        | jq -r '.[0].version // \"unknown\"' \\\n        | sed 's/^v//'\n}\n\ncheck_github_version() {\n    local label=\"$1\"\n    local repo=\"$2\"\n    local pinned_var=\"$3\"\n    local latest_var=\"$4\"\n\n    local latest pinned\n    pinned=\"${!pinned_var:-}\"\n\n    log_debug \"Checking ${label}: repo=${repo}, pinned_var=${pinned_var}\"\n\n    latest=\"$(get_latest_github_release \"$repo\")\"\n\n    if [[ -n \"$latest\" ]]; then\n        update_env_var \"$latest_var\" \"${latest#v}\"\n        log_info \"${label}: Pinned=\\\"${pinned}\\\" Latest=\\\"${latest#v}\\\"\"\n    else\n        update_env_var \"$latest_var\" \"unknown\"\n        log_warn \"Unable to resolve latest ${label} version\"\n    fi\n}\n\n# =============================================================================\n# MAIN\n# =============================================================================\n\nmain() {\n    log_info \"Starting version check\"\n\n    if [[ ! -f \"$BOOTSTRAP_ENV\" ]]; then\n        log_error \"bootstrap.env not found at ${BOOTSTRAP_ENV}\"\n        exit 1\n    fi\n\n    local backup_file\n    backup_file=\"${BOOTSTRAP_ENV}.bak.$(date +%s)\"\n\n    cp \"$BOOTSTRAP_ENV\" \"$backup_file\"\n    log_info \"Backup created: $(basename \"$backup_file\")\"\n\n    prune_old_backups \"$BOOTSTRAP_ENV\" \"$BACKUP_RETENTION\"\n\n    # shellcheck disable=SC1090\n    source \"$BOOTSTRAP_ENV\"\n    log_debug \"Loaded b.env\"\n\n    # -------------------------------------------------------------------------\n    # PHASE 1: HOST TOOLING\n    # -------------------------------------------------------------------------\n\n    log_info \"Phase 1: Host tooling\"\n\n    check_github_version \\\n        \"SOPS\" \\\n        \"getsops/sops\" \\\n        \"SOPS_VERSION\" \\\n        \"SOPS_VERSION_LATEST\"\n\n    check_github_version \\\n        \"K3s\" \\\n        \"k3s-io/k3s\" \\\n        \"K3S_VERSION\" \\\n        \"K3S_VERSION_LATEST\"\n\n    check_github_version \\\n        \"Helm\" \\\n        \"helm/helm\" \\\n        \"HELM_VERSION\" \\\n        \"HELM_VERSION_LATEST\"\n\n    # -------------------------------------------------------------------------\n    # PHASE 2: INFRASTRUCTURE\n    # -------------------------------------------------------------------------\n\n    log_info \"Phase 2: Infrastructure\"\n\n    check_github_version \\\n        \"Calico operator\" \\\n        \"projectcalico/calico\" \\\n        \"CALICO_OPERATOR_VERSION\" \\\n        \"CALICO_OPERATOR_VERSION_LATEST\"\n\n    # -------------------------------------------------------------------------\n    # PHASE 3: OPERATORS\n    # -------------------------------------------------------------------------\n\n    log_info \"Phase 3: Operator charts\"\n\n    local chart_var base name_var pinned_var\n    local release chart_ref pinned deployed latest\n\n    for chart_var in $(compgen -v | grep '_CHART$'); do\n        base=\"${chart_var%_CHART}\"\n\n        [[ \"$base\" =~ ^(CERT_MANAGER|TRAEFIK|SOPS_OPERATOR|CLOUDFLARED)$ ]] || continue\n\n        name_var=\"${base}_NAME\"\n        pinned_var=\"${base}_CHART_VERSION\"\n\n        release=\"${!name_var:-}\"\n        chart_ref=\"${!chart_var:-}\"\n        pinned=\"${!pinned_var:-}\"\n\n        if [[ -z \"$release\" || -z \"$chart_ref\" ]]; then\n            log_warn \"Skipping ${base} (missing NAME or CHART)\"\n            continue\n        fi\n\n        log_debug \"Checking chart=${chart_ref}, release=${release}\"\n\n        deployed=\"$(get_helm_deployed_chart_version \"$release\")\"\n        latest=\"$(get_helm_latest_chart_version \"$chart_ref\")\"\n\n        update_env_var \"${base}_CHART_VERSION_LATEST\" \"$latest\"\n        log_info \"${release}: Pinned=\\\"${pinned}\\\" Deployed=\\\"${deployed}\\\" Latest=\\\"${latest}\\\"\"\n    done\n\n    log_info \"Version check complete\"\n    log_info \"Updated: ${BOOTSTRAP_ENV}\"\n}\n\n# =============================================================================\n# ENTRYPOINT\n# =============================================================================\n\nmain \"$@\"\n"}
